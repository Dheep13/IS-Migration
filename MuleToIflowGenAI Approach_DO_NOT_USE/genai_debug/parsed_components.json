{
  "api_name": "Simple Product API",
  "base_url": "https://example.com/api",
  "endpoints": [
    {
      "method": "GET",
      "path": "/products",
      "purpose": "Retrieves a list of all products",
      "components": [
        {
          "type": "enricher",
          "name": "Prepare_Request_Headers",
          "id": "enricher_prepare_headers_1",
          "config": {
            "content": "Set request headers for products API call"
          }
        },
        {
          "type": "groovy_script",
          "name": "Log_Request",
          "id": "script_log_request_1",
          "config": {
            "script": "LogProductRequest.groovy"
          }
        },
        {
          "type": "odata",
          "name": "Get_Products",
          "id": "odata_get_products_1",
          "config": {
            "address": "https://example.com/odata/service",
            "resource_path": "Products",
            "operation": "Query(GET)",
            "query_options": "$select=Id,Name,Description,Price"
          }
        },
        {
          "type": "enricher",
          "name": "Set_Response_Headers",
          "id": "enricher_set_response_headers_1",
          "config": {
            "content": "Set response headers for products API response"
          }
        },
        {
          "type": "groovy_script",
          "name": "Transform_Response",
          "id": "script_transform_response_1",
          "config": {
            "script": "TransformProductsResponse.groovy"
          }
        }
      ],
      "sequence": [
        "enricher_prepare_headers_1",
        "script_log_request_1",
        "odata_get_products_1",
        "enricher_set_response_headers_1",
        "script_transform_response_1"
      ],
      "transformations": [
        {
          "name": "LogProductRequest.groovy",
          "type": "groovy",
          "script": "import com.sap.gateway.ip.core.customdev.util.Message;\n\ndef Message processData(Message message) {\n    def body = message.getBody(java.lang.String);\n    def map = message.getProperties();\n    def logger = map.get(\"logger\");\n    \n    logger.addAttachmentAsString(\"Request for products list\", body, \"text/plain\");\n    \n    return message;\n}"
        },
        {
          "name": "TransformProductsResponse.groovy",
          "type": "groovy",
          "script": "import com.sap.gateway.ip.core.customdev.util.Message;\nimport groovy.json.*;\n\ndef Message processData(Message message) {\n    def body = message.getBody(java.lang.String);\n    def jsonSlurper = new JsonSlurper();\n    def products = jsonSlurper.parseText(body);\n    \n    // Transform the products data as needed\n    def transformedProducts = products.collect { product ->\n        [\n            id: product.Id,\n            name: product.Name,\n            description: product.Description,\n            price: product.Price\n        ]\n    }\n    \n    message.setBody(JsonOutput.toJson(transformedProducts));\n    return message;\n}"
        }
      ]
    },
    {
      "method": "GET",
      "path": "/products/{id}",
      "purpose": "Retrieves details for a specific product",
      "components": [
        {
          "type": "enricher",
          "name": "Extract_Product_ID",
          "id": "enricher_extract_product_id_1",
          "config": {
            "content": "Extract product ID from request path"
          }
        },
        {
          "type": "groovy_script",
          "name": "Log_Product_Detail_Request",
          "id": "script_log_product_detail_1",
          "config": {
            "script": "LogProductDetailRequest.groovy"
          }
        },
        {
          "type": "odata",
          "name": "Get_Product_Detail",
          "id": "odata_get_product_detail_1",
          "config": {
            "address": "https://example.com/odata/service",
            "resource_path": "Products(${property.productId})",
            "operation": "Query(GET)",
            "query_options": "$select=Id,Name,Description,Price,Category,Supplier"
          }
        },
        {
          "type": "enricher",
          "name": "Set_Product_Detail_Response_Headers",
          "id": "enricher_set_product_detail_headers_1",
          "config": {
            "content": "Set response headers for product detail API response"
          }
        },
        {
          "type": "groovy_script",
          "name": "Transform_Product_Detail",
          "id": "script_transform_product_detail_1",
          "config": {
            "script": "TransformProductDetailResponse.groovy"
          }
        }
      ],
      "sequence": [
        "enricher_extract_product_id_1",
        "script_log_product_detail_1",
        "odata_get_product_detail_1",
        "enricher_set_product_detail_headers_1",
        "script_transform_product_detail_1"
      ],
      "transformations": [
        {
          "name": "LogProductDetailRequest.groovy",
          "type": "groovy",
          "script": "import com.sap.gateway.ip.core.customdev.util.Message;\n\ndef Message processData(Message message) {\n    def body = message.getBody(java.lang.String);\n    def map = message.getProperties();\n    def logger = map.get(\"logger\");\n    def productId = map.get(\"productId\");\n    \n    logger.addAttachmentAsString(\"Request for product ID: \" + productId, body, \"text/plain\");\n    \n    return message;\n}"
        },
        {
          "name": "TransformProductDetailResponse.groovy",
          "type": "groovy",
          "script": "import com.sap.gateway.ip.core.customdev.util.Message;\nimport groovy.json.*;\n\ndef Message processData(Message message) {\n    def body = message.getBody(java.lang.String);\n    def jsonSlurper = new JsonSlurper();\n    def product = jsonSlurper.parseText(body);\n    \n    // Transform the product detail data as needed\n    def transformedProduct = [\n        id: product.Id,\n        name: product.Name,\n        description: product.Description,\n        price: product.Price,\n        category: product.Category,\n        supplier: product.Supplier\n    ]\n    \n    message.setBody(JsonOutput.toJson(transformedProduct));\n    return message;\n}"
        }
      ]
    }
  ]
}