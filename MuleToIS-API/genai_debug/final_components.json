{
  "api_name": "Products API",
  "base_url": "/products",
  "endpoints": [
    {
      "method": "GET",
      "path": "/products",
      "purpose": "Retrieves product details based on a product identifier",
      "components": [
        {
          "type": "odata",
          "name": "Get_Product_Details",
          "id": "odata_get_product_1",
          "config": {
            "address": "${property.HANA_ODATA_SERVICE_URL}",
            "resource_path": "Products",
            "operation": "Query(GET)",
            "query_options": "$filter=ProductId eq '${property.productIdentifier}' and $select=ProductId,Category,CategoryName,CurrencyCode,DimensionDepth,DimensionHeight,DimensionUnit,DimensionWidth,LongDescription,Name,PictureUrl,Price,QuantityUnit,ShortDescription,SupplierId,Weight,WeightUnit"
          }
        },
        {
          "type": "enricher",
          "name": "Validate_Product_Identifier",
          "id": "enricher_validate_product_1",
          "config": {
            "content": "The product identifier validation logic will be handled by a Groovy script"
          }
        },
        {
          "type": "groovy_script",
          "name": "Check_Product_Identifier",
          "id": "groovy_check_product_1",
          "config": {
            "script": "ValidateProductIdentifier.groovy"
          }
        },
        {
          "type": "enricher",
          "name": "Format_Response",
          "id": "enricher_format_response_1",
          "config": {
            "content": "The response formatting will be handled by a Groovy script"
          }
        }
      ],
      "sequence": [
        "enricher_validate_product_1",
        "groovy_check_product_1",
        "odata_get_product_1",
        "enricher_format_response_1"
      ],
      "transformations": [
        {
          "name": "ValidateProductIdentifier.groovy",
          "type": "groovy",
          "script": "import com.sap.gateway.ip.core.customdev.util.Message;\nimport java.util.HashMap;\n\ndef Message processData(Message message) {\n    def body = message.getBody(String.class);\n    def headers = message.getHeaders();\n    def properties = message.getProperties();\n    \n    // Get query parameters\n    def map = message.getHeaders().get(\"SAP_MessageProcessingLogID\");\n    def productIdentifier = message.getProperty(\"productIdentifier\");\n    \n    // Get allowed product identifiers from property\n    def allowedProductIds = properties.get(\"odata.productIdentifiers\").split(\",\");\n    \n    // Check if product identifier is in the allowed list\n    boolean isValid = false;\n    for (String id : allowedProductIds) {\n        if (id.trim().equals(productIdentifier)) {\n            isValid = true;\n            break;\n        }\n    }\n    \n    // Set property for routing\n    message.setProperty(\"isExistProduct\", isValid);\n    \n    return message;\n}"
        },
        {
          "name": "FormatErrorResponse.groovy",
          "type": "groovy",
          "script": "import com.sap.gateway.ip.core.customdev.util.Message;\nimport groovy.json.JsonBuilder;\n\ndef Message processData(Message message) {\n    def body = message.getBody(String.class);\n    def headers = message.getHeaders();\n    def properties = message.getProperties();\n    \n    // Get product identifier from property\n    def productIdentifier = message.getProperty(\"productIdentifier\");\n    \n    // Create error response\n    def errorResponse = [\n        status: \"error\",\n        message: \"The product identifier \" + productIdentifier + \" was not found.\",\n        errorCode: \"PRODUCT_NOT_FOUND\"\n    ];\n    \n    // Convert to JSON\n    def jsonBuilder = new JsonBuilder(errorResponse);\n    message.setBody(jsonBuilder.toString());\n    \n    // Set content type header\n    message.setHeader(\"Content-Type\", \"application/json\");\n    \n    return message;\n}"
        }
      ],
      "sequence_flows": [
        {
          "id": "SequenceFlow_Start",
          "source": "odata_get_product_1",
          "target": "enricher_validate_product_1",
          "is_immediate": true,
          "xml_content": "<bpmn2:sequenceFlow id=\"SequenceFlow_Start\" sourceRef=\"odata_get_product_1\" targetRef=\"enricher_validate_product_1\" isImmediate=\"true\"/>"
        },
        {
          "id": "SequenceFlow_1",
          "source": "enricher_validate_product_1",
          "target": "groovy_check_product_1",
          "is_immediate": true,
          "xml_content": "<bpmn2:sequenceFlow id=\"SequenceFlow_1\" sourceRef=\"enricher_validate_product_1\" targetRef=\"groovy_check_product_1\" isImmediate=\"true\"/>"
        },
        {
          "id": "SequenceFlow_End",
          "source": "groovy_check_product_1",
          "target": "enricher_format_response_1",
          "is_immediate": true,
          "xml_content": "<bpmn2:sequenceFlow id=\"SequenceFlow_End\" sourceRef=\"groovy_check_product_1\" targetRef=\"enricher_format_response_1\" isImmediate=\"true\"/>"
        }
      ]
    }
  ]
}