{
    "process_name": "Create Salesforce Opportunities from Stripe Subscriptions",
    "description": "Integration that creates Salesforce Opportunities from Stripe subscription completion events with data transformation and dynamic property enhancement",
    "endpoints": [
        {
            "method": "POST",
            "path": "/stripe/webhook/subscription-completed",
            "purpose": "Receives Stripe subscription completion events and creates corresponding opportunities in Salesforce",
            "components": [
                {
                    "type": "enricher",
                    "name": "Set_Dynamic_Properties_from_Boomi",
                    "id": "enricher_dynamic_props",
                    "config": {
                        "content": "Calculate opportunity name, description, and close date from subscription data"
                    }
                },
                {
                    "type": "groovy_script",
                    "name": "Transform_Subscription_to_Opportunity_from_Boomi",
                    "id": "transform_subscription_data",
                    "config": {
                        "script": "TransformSubscriptionToOpportunity.groovy"
                    }
                },
                {
                    "type": "request_reply",
                    "name": "SF_Opportunity_CREATE_Operation_from_Boomi",
                    "id": "salesforce_create_opportunity",
                    "config": {
                        "endpoint_path": "/services/data/v58.0/sobjects/Opportunity"
                    }
                }
            ],
            "error_handling": {
                "exception_subprocess": []
            },
            "branching": {
                "type": "exclusive",
                "branches": []
            },
            "sequence": [
                "enricher_dynamic_props",
                "transform_subscription_data", 
                "salesforce_create_opportunity"
            ],
            "transformations": [
                {
                    "name": "TransformSubscriptionToOpportunity.groovy",
                    "type": "groovy",
                    "script": "import com.sap.gateway.ip.core.customdev.util.Message\\nimport groovy.json.JsonSlurper\\nimport groovy.json.JsonBuilder\\n\\ndef Message processData(Message message) {\\n    def body = message.getBody(String)\\n    def jsonSlurper = new JsonSlurper()\\n    def subscription = jsonSlurper.parseText(body)\\n    \\n    // Get dynamic properties calculated in previous step\\n    def opportunityName = message.getProperty('Opportunity.Name')\\n    def opportunityDescription = message.getProperty('Opportunity.Description')\\n    def opportunityCloseDate = message.getProperty('Opportunity.CloseDate')\\n    \\n    // Transform to Salesforce Opportunity format\\n    def opportunity = [\\n        Name: opportunityName,\\n        Description: opportunityDescription,\\n        CloseDate: opportunityCloseDate,\\n        StageName: 'Prospecting',\\n        Amount: subscription.data?.object?.items?.data[0]?.price?.unit_amount ? subscription.data.object.items.data[0].price.unit_amount / 100 : null\\n    ]\\n    \\n    def jsonBuilder = new JsonBuilder(opportunity)\\n    message.setBody(jsonBuilder.toString())\\n    \\n    return message\\n}"
                }
            ]
        }
    ]
}