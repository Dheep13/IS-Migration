{
  "method": "POST",
  "path": "/webhook/stripe/subscription",
  "purpose": "Receives subscription events from Stripe and creates Salesforce Opportunities",
  "components": [
    {
      "type": "enricher",
      "name": "Set_Salesforce_Description",
      "id": "set_sf_description",
      "config": {
        "content": "${property.CustomerName} has subscribed to: ${property.Subscription}"
      }
    },
    {
      "type": "message_mapping",
      "name": "Map_To_Salesforce_Opportunity",
      "id": "map_to_opportunity",
      "config": {}
    },
    {
      "type": "groovy_script",
      "name": "Calculate_Close_Date",
      "id": "calculate_close_date",
      "config": {
        "script": "CalculateCloseDate.groovy"
      }
    },
    {
      "type": "request_reply",
      "name": "Get_Stripe_Customer_Info",
      "id": "get_customer_info",
      "config": {
        "endpoint_path": "/v1/customers/{customer_id}",
        "address": "https://api.stripe.com"
      }
    },
    {
      "type": "request_reply",
      "name": "Get_Stripe_Product_Info",
      "id": "get_product_info",
      "config": {
        "endpoint_path": "/v1/products/{product_id}",
        "address": "https://api.stripe.com"
      }
    },
    {
      "type": "request_reply",
      "name": "Create_Salesforce_Opportunity",
      "id": "create_opportunity",
      "config": {
        "endpoint_path": "/services/data/v52.0/sobjects/Opportunity",
        "address": "https://salesforce.com"
      }
    }
  ],
  "sequence": [
    "get_customer_info",
    "get_product_info",
    "set_sf_description",
    "calculate_close_date",
    "map_to_opportunity",
    "create_opportunity"
  ]
}