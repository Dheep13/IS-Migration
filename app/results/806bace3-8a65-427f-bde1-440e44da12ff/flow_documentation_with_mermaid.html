<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table of Contents
- [API Overview](#api-overview)</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        .header {
            background-color: #1565c0;
            color: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            color: white;
        }
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }
        h1, h2, h3 {
            color: #1565c0;
        }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        code {
            background: #f5f5f5;
            padding: 2px 5px;
            border-radius: 3px;
        }
        pre.mermaid {
            text-align: center;
            background: white;
        }
        .mermaid-container {
            margin: 30px 0;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .mermaid-heading {
            color: #1565c0;
            margin-top: 0;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 10px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .note {
            background: #e3f2fd;
            padding: 10px;
            border-left: 4px solid #1565c0;
            margin: 10px 0;
        }
        .insights {
            background: #f3e5f5;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .best-practices {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .security {
            background: #ffebee;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Table of Contents
- [API Overview](#api-overview)</h1>
        <p>Generated on 2025-05-15 10:52</p>
    </div>

    <!-- MERMAID_HEADING_PROCESSED -->
<h1 id="table-of-contents">Table of Contents</h1>
<ul>
<li><a href="#api-overview">API Overview</a></li>
<li><a href="#endpoints">Endpoints</a></li>
<li><a href="#current-mulesoft-flow-logic">Current MuleSoft Flow Logic</a></li>
<li><a href="#products-main-flow">products-main Flow</a></li>
<li><a href="#products-console-flow">products-console Flow</a></li>
<li><a href="#getproductsproducts-config-flow">get:\products:products-config Flow</a></li>
<li><a href="#get-product-details-flow-subflow">get-product-details-flow Subflow</a></li>
<li><a href="#dataweave-transformations-explained">DataWeave Transformations Explained</a></li>
<li><a href="#isexistproduct-transformation">isExistProduct Transformation</a></li>
<li><a href="#odata-query-parameters-transformation">OData Query Parameters Transformation</a></li>
<li><a href="#product-response-transformation">Product Response Transformation</a></li>
<li><a href="#error-response-transformation">Error Response Transformation</a></li>
<li><a href="#sap-integration-suite-implementation">SAP Integration Suite Implementation</a></li>
<li><a href="#component-mapping">Component Mapping</a></li>
<li><a href="#integration-flow-visualization">Integration Flow Visualization</a></li>
<li><a href="#configuration-details">Configuration Details</a></li>
<li><a href="#configuration">Configuration</a></li>
</ul>
<h1 id="api-overview">API Overview</h1>
<p>This API provides product information from an SAP HANA database. It allows clients to retrieve detailed product information by providing a product identifier as a query parameter. The API validates the product identifier against a predefined list and returns either the product details or an error message if the product identifier is invalid or not found.</p>
<ul>
<li>Base URL: <code>/api/products</code></li>
</ul>
<h1 id="endpoints">Endpoints</h1>
<h2 id="get-products">GET /products</h2>
<ul>
<li><strong>Purpose</strong>: Retrieves detailed product information based on a product identifier</li>
<li><strong>Request Parameters</strong>:</li>
<li><strong>Query Parameters</strong>:<ul>
<li><code>productIdentifier</code> (required): The unique identifier of the product to retrieve</li>
</ul>
</li>
<li><strong>Headers</strong>: Standard HTTP headers</li>
<li><strong>Response Format</strong>:</li>
<li><strong>Success (200 OK)</strong>:<ul>
<li>Content-Type: application/json</li>
<li>Body: JSON object containing product details including ProductId, Category, CategoryName, CurrencyCode, dimensions, descriptions, price, and other product attributes</li>
</ul>
</li>
<li><strong>Error (400 Bad Request)</strong>:<ul>
<li>Content-Type: application/json</li>
<li>Body: JSON object with status, message, and errorCode fields</li>
</ul>
</li>
<li><strong>Example Response (Error)</strong>:
  <code>json
  {
    "status": "error",
    "message": "The product identifier ABC123 was not found.",
    "errorCode": "PRODUCT_NOT_FOUND"
  }</code></li>
</ul>
<h1 id="current-mulesoft-flow-logic">Current MuleSoft Flow Logic</h1>
<h2 id="products-main-flow">products-main Flow</h2>
<p>This is the main entry point for the API. It handles incoming HTTP requests and routes them to the appropriate flow based on the request path.</p>
<ol>
<li><strong>Trigger</strong>: HTTP listener configured with the <code>HTTP_Listener_config</code></li>
<li><strong>Processing Steps</strong>:</li>
<li>Sets response headers</li>
<li>Routes the request based on the API configuration in <code>products-config</code></li>
<li>Handles errors with an error response component</li>
<li><strong>Expected Outcome</strong>: Routes the request to the appropriate flow based on the API path</li>
</ol>
<h2 id="products-console-flow">products-console Flow</h2>
<p>This flow appears to be a console-based entry point, possibly for testing or monitoring purposes.</p>
<ol>
<li><strong>Trigger</strong>: HTTP listener configured with the <code>HTTP_Listener_config</code></li>
<li><strong>Processing Steps</strong>:</li>
<li>Sets response headers</li>
<li>Outputs to console</li>
<li>Handles errors with an error response component</li>
<li><strong>Expected Outcome</strong>: Logs information to the console</li>
</ol>
<h2 id="getproductsproducts-config-flow">get:\products:products-config Flow</h2>
<p>This flow handles GET requests to the <code>/products</code> endpoint.</p>
<ol>
<li><strong>Trigger</strong>: Routed from the main flow when a GET request to <code>/products</code> is received</li>
<li><strong>Processing Steps</strong>:</li>
<li>References the <code>get-product-details-flow</code> subflow to process the request</li>
<li><strong>Expected Outcome</strong>: Returns product details or an error message</li>
</ol>
<h2 id="get-product-details-flow-subflow">get-product-details-flow Subflow</h2>
<p>This subflow processes the product details request and retrieves the data from the SAP HANA database.</p>
<ol>
<li><strong>Trigger</strong>: Referenced from the <code>get:\products:products-config</code> flow</li>
<li><strong>Processing Steps</strong>:</li>
<li>Validates the product identifier against a predefined list using a DataWeave transformation</li>
<li>Sets a variable <code>isExistProduct</code> based on the validation result</li>
<li>Uses a choice router to handle valid and invalid product identifiers</li>
<li>For valid product identifiers:<ul>
<li>Logs the request processing</li>
<li>Sends an HTTP request to the SAP HANA database with OData query parameters</li>
<li>Transforms the response to JSON</li>
</ul>
</li>
<li>For invalid product identifiers:<ul>
<li>Logs the error</li>
<li>Returns an error response</li>
</ul>
</li>
<li><strong>Data Transformations</strong>:</li>
<li>Validates the product identifier against a list from a property</li>
<li>Constructs OData query parameters for filtering and selecting fields</li>
<li>Transforms the response payload to JSON</li>
<li><strong>Expected Outcomes</strong>:</li>
<li>Success: Returns product details in JSON format</li>
<li>Error: Returns an error message if the product identifier is invalid or not found</li>
</ol>
<h1 id="dataweave-transformations-explained">DataWeave Transformations Explained</h1>
<h2 id="isexistproduct-transformation">isExistProduct Transformation</h2>
<p>This transformation validates the product identifier against a predefined list of valid product identifiers.</p>
<ul>
<li><strong>Purpose</strong>: Determines if the provided product identifier exists in the allowed list</li>
<li><strong>Input</strong>: Product identifier from query parameters and a comma-separated list of valid identifiers from a property</li>
<li><strong>Output</strong>: Boolean value indicating if the product identifier is valid</li>
<li><strong>Logic</strong>: Splits the comma-separated list into an array, filters the array to find matches with the provided identifier, and checks if any matches were found</li>
</ul>
<pre class="codehilite"><code class="language-dw">%dw 2.0
output application/java
var productidentifer=p('odata.productIdentifiers') splitBy(&quot;,&quot;)
---
sizeOf(productidentifer filter ($ == attributes.queryParams.productIdentifier))&gt;0
</code></pre>

<h2 id="odata-query-parameters-transformation">OData Query Parameters Transformation</h2>
<p>This transformation constructs the OData query parameters for the HTTP request to the SAP HANA database.</p>
<ul>
<li><strong>Purpose</strong>: Creates the OData query parameters for filtering and selecting fields</li>
<li><strong>Input</strong>: Product identifier from query parameters</li>
<li><strong>Output</strong>: OData query parameters as a Java object</li>
<li><strong>Logic</strong>: Constructs a $filter parameter to filter by ProductId and a $select parameter to specify the fields to return</li>
</ul>
<pre class="codehilite"><code class="language-dw">#[output application/java
---
{
    &quot;$filter&quot; : &quot;ProductId eq '&quot; ++ (attributes.queryParams.productIdentifier default '') ++ &quot;'&quot;,
    &quot;$select&quot; : &quot;ProductId,Category,CategoryName,CurrencyCode,DimensionDepth,DimensionHeight,DimensionUnit,DimensionWidth,LongDescription,Name,PictureUrl,Price,QuantityUnit,ShortDescription,SupplierId,Weight,WeightUnit&quot;
}]
</code></pre>

<h2 id="product-response-transformation">Product Response Transformation</h2>
<p>This transformation passes through the response payload from the SAP HANA database.</p>
<ul>
<li><strong>Purpose</strong>: Transforms the response payload to JSON</li>
<li><strong>Input</strong>: Response payload from the SAP HANA database</li>
<li><strong>Output</strong>: JSON representation of the payload</li>
<li><strong>Logic</strong>: Simple pass-through transformation</li>
</ul>
<pre class="codehilite"><code class="language-dw">%dw 2.0
output application/json
---
payload
</code></pre>

<h2 id="error-response-transformation">Error Response Transformation</h2>
<p>This transformation constructs an error response when the product identifier is invalid or not found.</p>
<ul>
<li><strong>Purpose</strong>: Creates a standardized error response</li>
<li><strong>Input</strong>: Product identifier from query parameters</li>
<li><strong>Output</strong>: JSON error object with status, message, and errorCode</li>
<li><strong>Logic</strong>: Constructs an error message with the provided product identifier</li>
</ul>
<pre class="codehilite"><code class="language-dw">%dw 2.0
output application/json
---
{
    status: &quot;error&quot;,
    message: &quot;The product identifier &quot; ++ attributes.queryParams.productIdentifier ++ &quot; was not found.&quot;,
    errorCode: &quot;PRODUCT_NOT_FOUND&quot;
}
</code></pre>

<h1 id="sap-integration-suite-implementation">SAP Integration Suite Implementation</h1>
<h2 id="component-mapping">Component Mapping</h2>
<table>
<thead>
<tr>
<th>MuleSoft Component</th>
<th>SAP Integration Suite Equivalent</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>HTTP Listener</td>
<td>HTTPS Adapter (Receiver)</td>
<td>Configure with the same path and method</td>
</tr>
<tr>
<td>Router</td>
<td>Router</td>
<td>Standard component in both platforms</td>
</tr>
<tr>
<td>Flow Reference</td>
<td>Process Call</td>
<td>Used to call subflows</td>
</tr>
<tr>
<td>Transform Message</td>
<td>Content Modifier with script</td>
<td>Use Groovy or JavaScript for complex transformations</td>
</tr>
<tr>
<td>Logger</td>
<td>Write to Message Log</td>
<td>Standard logging component</td>
</tr>
<tr>
<td>HTTP Request</td>
<td>HTTPS Adapter (Sender)</td>
<td>Configure with the same endpoint and parameters</td>
</tr>
<tr>
<td>Set Variable</td>
<td>Content Modifier</td>
<td>Used to set variables in the message header</td>
</tr>
<tr>
<td>Choice Router</td>
<td>Router</td>
<td>Implement conditional routing</td>
</tr>
<tr>
<td>Set Payload</td>
<td>Content Modifier</td>
<td>Set the message body</td>
</tr>
<tr>
<td>Error Handler</td>
<td>Exception Subprocess</td>
<td>Handle errors with appropriate responses</td>
</tr>
</tbody>
</table>
<h2 id="rest-api-integration-flow-product-details-api">REST API Integration Flow: Product Details API</h2>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Main Flow
start((Start)):::httpAdapter --> mainListener[HTTP Listener]:::httpAdapter
mainListener --> mainRouter{Router}:::router
mainRouter -->|GET /products| getProductsFlow[[get:\products:products-config]]:::processCall

%% get:\products:products-config Flow
getProductsFlow --> getProductDetailsFlow[[get-product-details-flow]]:::processCall

%% get-product-details-flow Subflow
getProductDetailsFlow --> validateProduct[Transform - isExistProduct]:::mapping
validateProduct --> setVar[Set Variable - isExistProduct]:::contentModifier
setVar --> choiceRouter{Choice Router}:::router
choiceRouter -->|isExistProduct = true| logValid[Logger - Valid Product]:::contentModifier
logValid --> httpRequest[HTTP Request to SAP HANA]:::httpAdapter
httpRequest --> transformResponse[Transform Response]:::mapping
transformResponse --> responseEnd((End)):::httpAdapter

choiceRouter -->|isExistProduct = false| logInvalid[Logger - Invalid Product]:::contentModifier
logInvalid --> errorTransform[Transform - Error Response]:::mapping
errorTransform --> errorEnd((End)):::httpAdapter

%% Error Handling
mainListener --> errorHandler[(Global Error Handler)]:::exception
errorHandler --> apiKitErrors{APIKIT Errors}:::router
apiKitErrors -->|BAD_REQUEST| badRequestResponse[Error Response]:::contentModifier
apiKitErrors -->|NOT_FOUND| notFoundResponse[Error Response]:::contentModifier
apiKitErrors -->|METHOD_NOT_ALLOWED| methodNotAllowedResponse[Error Response]:::contentModifier
apiKitErrors -->|NOT_ACCEPTABLE| notAcceptableResponse[Error Response]:::contentModifier
apiKitErrors -->|UNSUPPORTED_MEDIA_TYPE| unsupportedMediaTypeResponse[Error Response]:::contentModifier
apiKitErrors -->|NOT_IMPLEMENTED| notImplementedResponse[Error Response]:::contentModifier

%% Console Flow
start --> consoleListener[HTTP Listener - Console]:::httpAdapter
consoleListener --> console[Console Output]:::contentModifier
console --> consoleEnd((End)):::httpAdapter
</pre>
<h2 id="configuration-details">Configuration Details</h2>
<h3 id="http-adapter-receiver-main-listener">HTTP Adapter (Receiver) - Main Listener</h3>
<ul>
<li><strong>Adapter Type</strong>: HTTPS</li>
<li><strong>Direction</strong>: Receiver</li>
<li><strong>Path</strong>: <code>/api/products</code></li>
<li><strong>Method</strong>: GET</li>
<li><strong>Authentication</strong>: As per source system requirements</li>
</ul>
<h3 id="http-adapter-receiver-console-listener">HTTP Adapter (Receiver) - Console Listener</h3>
<ul>
<li><strong>Adapter Type</strong>: HTTPS</li>
<li><strong>Direction</strong>: Receiver</li>
<li><strong>Path</strong>: <code>/console</code></li>
<li><strong>Method</strong>: GET</li>
<li><strong>Authentication</strong>: As per source system requirements</li>
</ul>
<h3 id="http-adapter-sender-sap-hana-request">HTTP Adapter (Sender) - SAP HANA Request</h3>
<ul>
<li><strong>Adapter Type</strong>: HTTPS</li>
<li><strong>Direction</strong>: Sender</li>
<li><strong>URL</strong>: Target SAP HANA OData service URL</li>
<li><strong>Method</strong>: GET</li>
<li><strong>Query Parameters</strong>: Dynamically set using script</li>
<li>$filter: <code>ProductId eq '{productIdentifier}'</code></li>
<li>$select: <code>ProductId,Category,CategoryName,CurrencyCode,DimensionDepth,DimensionHeight,DimensionUnit,DimensionWidth,LongDescription,Name,PictureUrl,Price,QuantityUnit,ShortDescription,SupplierId,Weight,WeightUnit</code></li>
</ul>
<h3 id="router-choice-router">Router - Choice Router</h3>
<ul>
<li><strong>Condition 1</strong>: <code>${header.isExistProduct} == true</code></li>
<li><strong>Condition 2</strong>: <code>${header.isExistProduct} == false</code></li>
</ul>
<h3 id="content-modifier-set-variable">Content Modifier - Set Variable</h3>
<ul>
<li><strong>Action</strong>: Set Header</li>
<li><strong>Name</strong>: isExistProduct</li>
<li><strong>Value</strong>: Result of script evaluation</li>
</ul>
<h3 id="content-modifier-transform-response">Content Modifier - Transform Response</h3>
<ul>
<li><strong>Action</strong>: Set Body</li>
<li><strong>Type</strong>: Expression</li>
<li><strong>Value</strong>: <code>${body}</code></li>
</ul>
<h3 id="content-modifier-error-response">Content Modifier - Error Response</h3>
<ul>
<li><strong>Action</strong>: Set Body</li>
<li><strong>Type</strong>: Expression</li>
<li><strong>Value</strong>: JSON structure with error details</li>
</ul>
<h3 id="write-to-message-log-logger">Write to Message Log - Logger</h3>
<ul>
<li><strong>Log Level</strong>: INFO</li>
<li><strong>Message</strong>: Dynamic message based on context</li>
</ul>
<h3 id="exception-subprocess-global-error-handler">Exception Subprocess - Global Error Handler</h3>
<ul>
<li><strong>Error Types</strong>: Various APIKIT errors</li>
<li><strong>Response</strong>: Appropriate error messages for each error type</li>
</ul>
<h1 id="configuration">Configuration</h1>
<h2 id="important-configuration-parameters">Important Configuration Parameters</h2>
<ul>
<li><strong>odata.productIdentifiers</strong>: Comma-separated list of valid product identifiers</li>
</ul>
<h2 id="http-configuration">HTTP Configuration</h2>
<ul>
<li><strong>HTTP_Listener_config</strong>: Configuration for the HTTP listener</li>
<li><strong>Hana_HTTP_Request_Configuration</strong>: Configuration for the HTTP request to SAP HANA</li>
</ul>
<h2 id="api-configuration">API Configuration</h2>
<ul>
<li><strong>products-config</strong>: RAML API configuration</li>
<li><strong>api</strong>: products.raml</li>
<li><strong>outboundHeadersMapName</strong>: outboundHeaders</li>
<li><strong>httpStatusVarName</strong>: httpStatus</li>
</ul>
<h2 id="error-handling">Error Handling</h2>
<ul>
<li><strong>Global_Error_Handler</strong>: Handles various APIKIT errors:</li>
<li>APIKIT:BAD_REQUEST</li>
<li>APIKIT:NOT_FOUND</li>
<li>APIKIT:METHOD_NOT_ALLOWED</li>
<li>APIKIT:NOT_ACCEPTABLE</li>
<li>APIKIT:UNSUPPORTED_MEDIA_TYPE</li>
<li>APIKIT:NOT_IMPLEMENTED</li>
</ul>

    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
</body>
</html>