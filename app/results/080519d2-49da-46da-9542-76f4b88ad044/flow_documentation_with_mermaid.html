<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation with Mermaid</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        h1, h2, h3 {
            color: #1565c0;
        }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        code {
            background: #f5f5f5;
            padding: 2px 5px;
            border-radius: 3px;
        }
        pre.mermaid {
            text-align: center;
            background: white;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .note {
            background: #e3f2fd;
            padding: 10px;
            border-left: 4px solid #1565c0;
            margin: 10px 0;
        }
        .insights {
            background: #f3e5f5;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .best-practices {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .security {
            background: #ffebee;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1 id="api-overview">API Overview</h1>
<p>The Financial Services Cloud Wealth Management API provides comprehensive functionality for managing investment accounts, beneficiaries, standing orders, customer profiles, and specialized financial operations like ACATS (Automated Customer Account Transfer Service) and RMD (Required Minimum Distribution). This API enables financial institutions to handle wealth management operations through standardized RESTful endpoints.</p>
<ul>
<li>Base URL: <code>/fsc-wealth-management-api</code></li>
</ul>
<h1 id="endpoints">Endpoints</h1>
<h2 id="investment-accounts">Investment Accounts</h2>
<h3 id="post-investmentaccountsinitiate">POST /InvestmentAccounts/Initiate</h3>
<ul>
<li><strong>Purpose</strong>: Initiates the creation of beneficiaries for investment accounts</li>
<li><strong>Request Body</strong>: JSON containing investment account details and beneficiary information</li>
<li><strong>Response</strong>: 201 Created with the created beneficiaries information</li>
<li><strong>Example Response</strong>:
  <code>json
  {
    "InvestmentAccounts": {
      "AccountIds": ["account123"],
      "Beneficiaries": {
        "Primary": [
          {
            "BeneficiaryId": "BFR-1234567",
            "BeneficiaryName": "John Doe",
            "BeneficiaryType": "Individual",
            "SharePercentage": "50"
          }
        ],
        "Contingent": [
          {
            "BeneficiaryId": "BFR-7654321",
            "BeneficiaryName": "Jane Doe",
            "BeneficiaryType": "Individual",
            "SharePercentage": "50"
          }
        ]
      }
    }
  }</code></li>
</ul>
<h3 id="patch-investmentaccountsupdate">PATCH /InvestmentAccounts/Update</h3>
<ul>
<li><strong>Purpose</strong>: Updates existing beneficiaries for investment accounts</li>
<li><strong>Request Body</strong>: JSON containing investment account details and beneficiary information to update</li>
<li><strong>Response</strong>: 200 OK with the updated beneficiaries information</li>
</ul>
<h3 id="delete-investmentaccountsdelete">DELETE /InvestmentAccounts/Delete</h3>
<ul>
<li><strong>Purpose</strong>: Deletes beneficiaries from investment accounts</li>
<li><strong>Request Body</strong>: JSON containing investment account and beneficiary IDs to delete</li>
<li><strong>Response</strong>: 200 OK with confirmation of deleted beneficiaries</li>
</ul>
<h3 id="get-investmentaccountsaccountidretrieve">GET /InvestmentAccounts/{accountId}/Retrieve</h3>
<ul>
<li><strong>Purpose</strong>: Retrieves investment account details including beneficiaries</li>
<li><strong>Path Parameters</strong>: </li>
<li><code>accountId</code>: The ID of the investment account to retrieve</li>
<li><strong>Response</strong>: 200 OK with the investment account details and beneficiaries</li>
</ul>
<h2 id="payments">Payments</h2>
<h3 id="post-investmentaccountsaccountidpaymentsinitiate">POST /InvestmentAccounts/{accountId}/Payments/Initiate</h3>
<ul>
<li><strong>Purpose</strong>: Initiates standing orders for an investment account</li>
<li><strong>Path Parameters</strong>: </li>
<li><code>accountId</code>: The ID of the investment account</li>
<li><strong>Request Body</strong>: JSON containing payment order details</li>
<li><strong>Response</strong>: 201 Created with the created payment orders</li>
</ul>
<h3 id="patch-investmentaccountsaccountidpaymentsupdate">PATCH /InvestmentAccounts/{accountId}/Payments/Update</h3>
<ul>
<li><strong>Purpose</strong>: Updates or cancels existing standing orders</li>
<li><strong>Path Parameters</strong>: </li>
<li><code>accountId</code>: The ID of the investment account</li>
<li><strong>Request Body</strong>: JSON containing payment IDs to cancel</li>
<li><strong>Response</strong>: 200 OK with confirmation of canceled payment orders</li>
</ul>
<h3 id="get-investmentaccountsaccountidpaymentsretrieve">GET /InvestmentAccounts/{accountId}/Payments/Retrieve</h3>
<ul>
<li><strong>Purpose</strong>: Retrieves standing orders for an investment account</li>
<li><strong>Path Parameters</strong>: </li>
<li><code>accountId</code>: The ID of the investment account</li>
<li><strong>Query Parameters</strong>:</li>
<li><code>paymentId</code> (optional): Filter by payment ID</li>
<li><code>payeeName</code> (optional): Filter by payee name</li>
<li><code>amount</code> (optional): Filter by payment amount</li>
<li><strong>Response</strong>: 200 OK with the matching payment orders</li>
</ul>
<h2 id="customer-profile">Customer Profile</h2>
<h3 id="patch-customerscustomerid">PATCH /customers/{customerId}</h3>
<ul>
<li><strong>Purpose</strong>: Updates a customer's profile information</li>
<li><strong>Path Parameters</strong>: </li>
<li><code>customerId</code>: The ID of the customer</li>
<li><strong>Request Body</strong>: JSON containing profile information to update</li>
<li><strong>Response</strong>: 200 OK with the updated profile information</li>
</ul>
<h2 id="specialized-financial-operations">Specialized Financial Operations</h2>
<h3 id="post-investmentaccountsaccountidacats">POST /InvestmentAccounts/{accountId}/Acats</h3>
<ul>
<li><strong>Purpose</strong>: Initiates an ACATS transfer for an investment account</li>
<li><strong>Path Parameters</strong>: </li>
<li><code>accountId</code>: The ID of the investment account</li>
<li><strong>Request Body</strong>: JSON containing ACATS transfer details</li>
<li><strong>Response</strong>: 201 Created with the ACATS transfer information</li>
</ul>
<h3 id="post-investmentaccountsaccountidrmd">POST /InvestmentAccounts/{accountId}/RMD</h3>
<ul>
<li><strong>Purpose</strong>: Initiates a Required Minimum Distribution for an investment account</li>
<li><strong>Path Parameters</strong>: </li>
<li><code>accountId</code>: The ID of the investment account</li>
<li><strong>Request Body</strong>: JSON containing RMD details</li>
<li><strong>Response</strong>: 201 Created with the RMD information</li>
</ul>
<h1 id="current-mulesoft-flow-logic">Current MuleSoft Flow Logic</h1>
<h2 id="main-api-flow">Main API Flow</h2>
<p>The main flow (<code>fsc-wealth-management-api-main</code>) serves as the entry point for all API requests. It:
1. Receives HTTP requests through a listener component
2. Logs request details including requestId and flowRefId
3. Routes the request to the appropriate flow based on the endpoint
4. Handles errors through a dedicated error handler</p>
<h2 id="investment-account-flows">Investment Account Flows</h2>
<h3 id="add-beneficiaries-flow">Add Beneficiaries Flow</h3>
<p><strong>Trigger</strong>: POST request to <code>/InvestmentAccounts/Initiate</code>
<strong>Processing Steps</strong>:
1. Routes to <code>add-beneficiaries-sub-flow</code>
2. Transforms the request payload using DataWeave
3. Generates unique BeneficiaryId values for each beneficiary
4. Returns the transformed response with status 201</p>
<h3 id="update-beneficiaries-flow">Update Beneficiaries Flow</h3>
<p><strong>Trigger</strong>: PATCH request to <code>/InvestmentAccounts/Update</code>
<strong>Processing Steps</strong>:
1. Routes to <code>update-beneficiaries-sub-flow</code>
2. Transforms the request payload using DataWeave
3. Generates BeneficiaryId values for new beneficiaries if needed
4. Returns the transformed response with status 200</p>
<h3 id="delete-beneficiaries-flow">Delete Beneficiaries Flow</h3>
<p><strong>Trigger</strong>: DELETE request to <code>/InvestmentAccounts/Delete</code>
<strong>Processing Steps</strong>:
1. Routes to <code>delete-beneficiaries-sub-flow</code>
2. Transforms the request payload using DataWeave
3. Marks beneficiaries as "DELETED"
4. Returns the transformed response with status 200</p>
<h3 id="retrieve-investment-account-details-flow">Retrieve Investment Account Details Flow</h3>
<p><strong>Trigger</strong>: GET request to <code>/InvestmentAccounts/{accountId}/Retrieve</code>
<strong>Processing Steps</strong>:
1. Routes to <code>retrieve-investment-account-details-sub-flow</code>
2. Sets account details in a variable
3. Transforms the data using DataWeave
4. Returns the account details and beneficiaries with status 200</p>
<h2 id="payment-flows">Payment Flows</h2>
<h3 id="add-standing-orders-flow">Add Standing Orders Flow</h3>
<p><strong>Trigger</strong>: POST request to <code>/InvestmentAccounts/{accountId}/Payments/Initiate</code>
<strong>Processing Steps</strong>:
1. Routes to <code>add-standing-orders-sub-flow</code>
2. Transforms the request payload using DataWeave
3. Generates unique PaymentId values for each payment
4. Returns the transformed response with status 201</p>
<h3 id="cancel-standing-orders-flow">Cancel Standing Orders Flow</h3>
<p><strong>Trigger</strong>: PATCH request to <code>/InvestmentAccounts/{accountId}/Payments/Update</code>
<strong>Processing Steps</strong>:
1. Routes to <code>cancel-standing-orders-sub-flow</code>
2. Transforms the request payload using DataWeave
3. Marks payments as canceled with current timestamp
4. Returns the transformed response with status 200</p>
<h3 id="retrieve-standing-orders-flow">Retrieve Standing Orders Flow</h3>
<p><strong>Trigger</strong>: GET request to <code>/InvestmentAccounts/{accountId}/Payments/Retrieve</code>
<strong>Processing Steps</strong>:
1. Routes to <code>retrieve-standing-orders-sub-flow</code>
2. Logs query parameters
3. Sets standing orders in a variable
4. Filters orders based on query parameters (paymentId, payeeName, amount)
5. Returns the filtered payment orders with status 200</p>
<h2 id="customer-profile-flow">Customer Profile Flow</h2>
<h3 id="update-customer-profile-flow">Update Customer Profile Flow</h3>
<p><strong>Trigger</strong>: PATCH request to <code>/customers/{customerId}</code>
<strong>Processing Steps</strong>:
1. Routes to <code>update-customers-profile-sub-flow</code>
2. Transforms the request payload using DataWeave
3. Returns the updated profile information with status 200</p>
<h2 id="specialized-financial-operations-flows">Specialized Financial Operations Flows</h2>
<h3 id="acats-flow">ACATS Flow</h3>
<p><strong>Trigger</strong>: POST request to <code>/InvestmentAccounts/{accountId}/Acats</code>
<strong>Processing Steps</strong>:
1. Routes to <code>prepare-acats-response-sub-flow</code>
2. Transforms the request payload using DataWeave
3. Returns the ACATS information with status 201</p>
<h3 id="rmd-flow">RMD Flow</h3>
<p><strong>Trigger</strong>: POST request to <code>/InvestmentAccounts/{accountId}/RMD</code>
<strong>Processing Steps</strong>:
1. Routes to <code>prepare-rmd-response-sub-flow</code>
2. Transforms the request payload using DataWeave
3. Returns the RMD information with status 201</p>
<h1 id="dataweave-transformations-explained">DataWeave Transformations Explained</h1>
<h2 id="error-handling-transformations">Error Handling Transformations</h2>
<h3 id="e-400dwl">e-400.dwl</h3>
<p>This transformation creates a standardized error response for 400 Bad Request errors.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">  </span><span class="s">&quot;errorCode&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;400&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;errorMessage&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">(((</span><span class="n">error</span><span class="p">.</span><span class="n">description</span><span class="w"> </span><span class="n">splitBy</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">distinctBy</span><span class="w"> </span><span class="n">$</span><span class="p">)</span><span class="w"> </span><span class="n">orderBy</span><span class="w"> </span><span class="n">$</span><span class="p">)[</span><span class="mi">-1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span>
<span class="w">  </span><span class="s">&quot;transactionId&quot;</span><span class="o">:</span><span class="w"> </span><span class="n">correlationId</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;timeStamp&quot;</span><span class="o">:</span><span class="w"> </span><span class="n">now</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p>The transformation:
- Takes the error description and splits it by newlines
- Removes duplicates with <code>distinctBy $</code>
- Orders the remaining messages
- Takes the last message (most specific) using array slicing <code>[-1 to 0]</code>
- Adds a transaction ID and timestamp</p>
<h2 id="beneficiary-management-transformations">Beneficiary Management Transformations</h2>
<h3 id="p-addbeneficiariesresponsedwl">p-addBeneficiariesResponse.dwl</h3>
<p>This transformation generates a response for adding beneficiaries, including unique IDs.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfr</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BFR-&quot;</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrTrack</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BFRTRACK&quot;</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrNumbers</span><span class="o">=</span><span class="w"> </span><span class="err">&#39;</span><span class="mo">01234567</span><span class="mi">89</span><span class="err">&#39;</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrCharSetLength</span><span class="o">=</span><span class="w"> </span><span class="n">sizeOf</span><span class="p">(</span><span class="n">bfrNumbers</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrNumbersLength</span><span class="o">=</span><span class="w"> </span><span class="mi">7</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w"> </span><span class="n">skipNullOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">    </span><span class="nl">InvestmentAccounts</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">AccountIds</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">InvestmentAccounts</span><span class="p">.</span><span class="n">AccountIds</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">accountId</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">indexOfAccountId</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">accountId</span><span class="p">,</span>
<span class="w">        </span><span class="nl">Beneficiaries</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nl">Primary</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">InvestmentAccounts</span><span class="p">.</span><span class="n">Beneficiaries</span><span class="p">.</span><span class="n">Primary</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nl">BeneficiaryId</span><span class="p">:</span><span class="w"> </span><span class="n">bfr</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">bfrNumbersLength</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="n">bfrNumbers</span><span class="p">[</span><span class="n">randomInt</span><span class="p">(</span><span class="n">bfrCharSetLength</span><span class="p">)]</span><span class="w"> </span><span class="n">joinBy</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}),</span>
<span class="w">            </span><span class="nl">Contingent</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">InvestmentAccounts</span><span class="p">.</span><span class="n">Beneficiaries</span><span class="p">.</span><span class="n">Contingent</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nl">BeneficiaryId</span><span class="p">:</span><span class="w"> </span><span class="n">bfr</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">bfrNumbersLength</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="n">bfrNumbers</span><span class="p">[</span><span class="n">randomInt</span><span class="p">(</span><span class="n">bfrCharSetLength</span><span class="p">)]</span><span class="w"> </span><span class="n">joinBy</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>The transformation:
- Defines variables for generating unique beneficiary IDs
- Maps through the account IDs from the input payload
- For each primary and contingent beneficiary, adds a unique BeneficiaryId
- The ID format is "BFR-" followed by 7 random digits
- Uses <code>skipNullOn = "everywhere"</code> to remove null values from the output</p>
<h3 id="p-updatebeneficiariesresponsedwl">p-updateBeneficiariesResponse.dwl</h3>
<p>This transformation handles updating beneficiaries, including generating IDs for new beneficiaries.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfr</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BFR-&quot;</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrTrack</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BFRTRACK&quot;</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrNumbers</span><span class="o">=</span><span class="w"> </span><span class="err">&#39;</span><span class="mo">01234567</span><span class="mi">89</span><span class="err">&#39;</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrCharSetLength</span><span class="o">=</span><span class="w"> </span><span class="n">sizeOf</span><span class="p">(</span><span class="n">bfrNumbers</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrNumbersLength</span><span class="o">=</span><span class="w"> </span><span class="mi">7</span>

<span class="n">fun</span><span class="w"> </span><span class="n">treeFilter</span><span class="p">(</span><span class="n">value</span><span class="o">:</span><span class="w"> </span><span class="n">Any</span><span class="p">,</span><span class="w"> </span><span class="n">predicate</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="o">:</span><span class="n">Any</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Boolean</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">value</span><span class="w">  </span><span class="n">match</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">object</span><span class="w"> </span><span class="no">is</span><span class="w"> </span><span class="no">Object</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">  </span><span class="no">do</span><span class="w"> </span><span class="err">{</span>
<span class="w">               </span><span class="no">object</span><span class="w"> </span><span class="no">mapObject</span><span class="w"> </span><span class="p">((</span><span class="no">value</span><span class="p">,</span><span class="w"> </span><span class="no">key</span><span class="p">,</span><span class="w"> </span><span class="no">index</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span>
<span class="w">                    </span><span class="p">(</span><span class="no">key</span><span class="p">):</span><span class="w"> </span><span class="n">treeFilter</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">predicate</span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">                </span><span class="n">filterObject</span><span class="w"> </span><span class="p">((</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">predicate</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">array</span><span class="w"> </span><span class="no">is</span><span class="w"> </span><span class="no">Array</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">do</span><span class="w"> </span><span class="err">{</span>
<span class="w">                    </span><span class="no">array</span><span class="w"> </span><span class="no">map</span><span class="w"> </span><span class="p">((</span><span class="no">item</span><span class="p">,</span><span class="w"> </span><span class="no">index</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">treeFilter</span><span class="p">(</span><span class="no">item</span><span class="p">,</span><span class="w"> </span><span class="no">predicate</span><span class="p">))</span>
<span class="w">                                         </span><span class="no">filter</span><span class="w"> </span><span class="p">((</span><span class="no">item</span><span class="p">,</span><span class="w"> </span><span class="no">index</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">predicate</span><span class="p">(</span><span class="no">item</span><span class="p">))</span><span class="w">                 </span>
<span class="w">            </span><span class="err">}</span>
<span class="w">            </span><span class="no">else</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">$</span>
<span class="w">    </span><span class="err">}</span>

<span class="no">output</span><span class="w"> </span><span class="no">application</span><span class="o">/</span><span class="no">json</span><span class="w"> </span><span class="no">skipNullOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="err">{</span>
<span class="w">    </span><span class="nl">InvestmentAccounts</span><span class="p">:</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="nl">AccountIds</span><span class="p">:</span><span class="w"> </span><span class="no">payload</span><span class="p">.</span><span class="no">InvestmentAccounts</span><span class="p">.</span><span class="no">AccountIds</span><span class="w"> </span><span class="no">map</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="no">accountId</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="no">indexOfAccountId</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">accountId</span><span class="p">,</span>
<span class="w">        </span><span class="nl">Addresses</span><span class="p">:</span><span class="w"> </span><span class="no">payload</span><span class="p">.</span><span class="no">InvestmentAccounts</span><span class="p">.</span><span class="no">Addresses</span><span class="p">,</span>
<span class="w">        </span><span class="nl">Beneficiaries</span><span class="p">:</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="nl">Primary</span><span class="p">:</span><span class="w"> </span><span class="no">payload</span><span class="p">.</span><span class="no">InvestmentAccounts</span><span class="p">.</span><span class="no">Beneficiaries</span><span class="p">.</span><span class="no">Primary</span><span class="w"> </span><span class="no">map</span><span class="w"> </span><span class="no">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="no">$</span><span class="p">.</span><span class="no">BeneficiaryId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">null</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="no">$</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="err">{</span>
<span class="w">                </span><span class="s">&quot;BeneficiaryId&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">bfr</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">bfrNumbersLength</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="n">bfrNumbers</span><span class="p">[</span><span class="n">randomInt</span><span class="p">(</span><span class="n">bfrCharSetLength</span><span class="p">)]</span><span class="w"> </span><span class="n">joinBy</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">})</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">$</span><span class="p">,</span>
<span class="w">            </span><span class="nl">Contingent</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">InvestmentAccounts</span><span class="p">.</span><span class="n">Beneficiaries</span><span class="p">.</span><span class="n">Contingent</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">BeneficiaryId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">null</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;BeneficiaryId&quot;</span><span class="o">:</span><span class="w"> </span><span class="n">bfr</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">bfrNumbersLength</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="n">bfrNumbers</span><span class="p">[</span><span class="n">randomInt</span><span class="p">(</span><span class="n">bfrCharSetLength</span><span class="p">)]</span><span class="w"> </span><span class="n">joinBy</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">})</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">$</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span><span class="w"> </span><span class="n">treeFilter</span><span class="w"> </span><span class="p">((</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span>
<span class="w">    </span><span class="n">value</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">v</span><span class="w"> </span><span class="no">is</span><span class="w"> </span><span class="no">Array</span><span class="o">|</span><span class="w"> </span><span class="no">Object</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">Null</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="no">isEmpty</span><span class="p">(</span><span class="no">v</span><span class="p">)</span>
<span class="w">        </span><span class="no">else</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">true</span>
<span class="w">    </span><span class="err">}</span>
<span class="p">)</span>
</code></pre></div>

<p>The transformation:
- Defines variables for generating unique beneficiary IDs
- Defines a recursive <code>treeFilter</code> function to remove empty values from the output
- Maps through account IDs from the input payload
- For each primary and contingent beneficiary, checks if BeneficiaryId is null
- If null, generates a new ID; otherwise, keeps the existing ID
- Applies the treeFilter function to remove empty values from the entire output</p>
<h3 id="p-deletebeneficiariesresponsedwl">p-deleteBeneficiariesResponse.dwl</h3>
<p>This transformation creates a response for deleting beneficiaries.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w"> </span><span class="n">skipNullOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">    </span><span class="nl">InvestmentAccounts</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">AccountIds</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">InvestmentAccounts</span><span class="p">.</span><span class="n">AccountIds</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">accountId</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">indexOfAccountId</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">accountId</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="nl">Beneficiaries</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">InvestmentAccounts</span><span class="p">.</span><span class="n">Beneficiaries</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nl">BeneficiaryId</span><span class="p">:</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">BeneficiaryId</span><span class="p">,</span>
<span class="w">            </span><span class="nl">Status</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DELETED&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>The transformation:
- Maps through account IDs from the input payload
- For each beneficiary, creates an object with the BeneficiaryId and a "DELETED" status
- Uses <code>skipNullOn = "everywhere"</code> to remove null values from the output</p>
<h2 id="payment-management-transformations">Payment Management Transformations</h2>
<h3 id="p-addpaymentordersresponsedwl">p-addPaymentOrdersResponse.dwl</h3>
<p>This transformation generates a response for adding payment orders, including unique IDs.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">var</span><span class="w"> </span><span class="n">sot</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PMT&quot;</span>
<span class="n">var</span><span class="w"> </span><span class="n">stordTrack</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;STORDTRACK&quot;</span>
<span class="n">var</span><span class="w"> </span><span class="n">sotNumbers</span><span class="o">=</span><span class="w"> </span><span class="err">&#39;</span><span class="mo">01234567</span><span class="mi">89</span><span class="err">&#39;</span>
<span class="n">var</span><span class="w"> </span><span class="n">sotCharSetLength</span><span class="o">=</span><span class="w"> </span><span class="n">sizeOf</span><span class="p">(</span><span class="n">sotNumbers</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="n">var</span><span class="w"> </span><span class="n">sotNumbersLength</span><span class="o">=</span><span class="w"> </span><span class="mi">7</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w"> </span><span class="n">skipNullOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">    </span><span class="nl">Payments</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">Payments</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">CreationDateTime</span><span class="p">:</span><span class="w"> </span><span class="n">now</span><span class="p">(),</span>
<span class="w">        </span><span class="nl">PaymentId</span><span class="p">:</span><span class="w"> </span><span class="n">sot</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">sotNumbersLength</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="n">sotNumbers</span><span class="p">[</span><span class="n">randomInt</span><span class="p">(</span><span class="n">sotCharSetLength</span><span class="p">)]</span><span class="w"> </span><span class="n">joinBy</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>

<p>The transformation:
- Defines variables for generating unique payment IDs
- Maps through the payments from the input payload
- For each payment, adds a CreationDateTime (current time) and a unique PaymentId
- The ID format is "PMT" followed by 7 random digits
- Uses <code>skipNullOn = "everywhere"</code> to remove null values from the output</p>
<h3 id="p-cancelpaymentordersresponsedwl">p-cancelPaymentOrdersResponse.dwl</h3>
<p>This transformation creates a response for canceling payment orders.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">    </span><span class="nl">PaymentIds</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">PaymentIds</span><span class="p">,</span>
<span class="w">    </span><span class="nl">CancelDateTime</span><span class="p">:</span><span class="w"> </span><span class="n">now</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p>The transformation:
- Takes the PaymentIds from the input payload
- Adds a CancelDateTime with the current time</p>
<h3 id="p-retrievepaymentordersresponsedwl">p-retrievePaymentOrdersResponse.dwl</h3>
<p>This transformation filters payment orders based on query parameters.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w">  </span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">  </span><span class="nl">PaymentOrders</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="o">?</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="o">?</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">PaymentId</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PayeeReference</span><span class="p">.</span><span class="n">PayeeName</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PaymentDefinition</span><span class="p">.</span><span class="n">PaymentAmount</span><span class="p">.</span><span class="n">Amount</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="o">?</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">PaymentId</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PayeeReference</span><span class="p">.</span><span class="n">PayeeName</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="o">?</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">PaymentId</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PaymentDefinition</span><span class="p">.</span><span class="n">PaymentAmount</span><span class="p">.</span><span class="n">Amount</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="o">?</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PayeeReference</span><span class="p">.</span><span class="n">PayeeName</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PaymentDefinition</span><span class="p">.</span><span class="n">PaymentAmount</span><span class="p">.</span><span class="n">Amount</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">PaymentId</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PayeeReference</span><span class="p">.</span><span class="n">PayeeName</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PaymentDefinition</span><span class="p">.</span><span class="n">PaymentAmount</span><span class="p">.</span><span class="n">Amount</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span>
<span class="p">}</span>
</code></pre></div>

<p>The transformation:
- Uses a series of conditional statements to filter payment orders based on query parameters
- Checks for various combinations of filter parameters (paymentId, payeeName, amount)
- Uses the <code>~=</code> operator for case-insensitive matching
- Returns all payment orders if no filters are provided</p>
<h2 id="specialized-financial-operations-transformations">Specialized Financial Operations Transformations</h2>
<h3 id="p-acatresponsedwl">p-acatResponse.dwl</h3>
<p>This transformation creates a response for ACATS transfers.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w"> </span><span class="n">skipNullOn</span><span class="o">=</span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">    </span><span class="nl">AcatDetails</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">TransferType</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferType</span><span class="p">,</span>
<span class="w">        </span><span class="nl">AcatType</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">AcatType</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">null</span><span class="p">,</span>
<span class="w">        </span><span class="nl">TransferAction</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferAction</span><span class="p">,</span>
<span class="w">        </span><span class="nl">TransferDetails</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nl">Securities</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferDetails</span><span class="p">.</span><span class="n">Securities</span><span class="p">,</span>
<span class="w">            </span><span class="nl">Cash</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferDetails</span><span class="p">.</span><span class="n">Cash</span><span class="p">,</span>
<span class="w">            </span><span class="nl">FundsTransfer</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferDetails</span><span class="p">.</span><span class="n">FundsTransfer</span><span class="p">,</span>
<span class="w">            </span><span class="nl">CashTransfer</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferDetails</span><span class="p">.</span><span class="n">CashTransfer</span><span class="p">,</span>
<span class="w">            </span><span class="nl">CDTransfer</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferDetails</span><span class="p">.</span><span class="n">CDTransfer</span><span class="p">,</span>
<span class="w">            </span><span class="nl">AnnuityTransfer</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferDetails</span><span class="p">.</span><span class="n">AnnuityTransfer</span><span class="p">,</span>
<span class="w">            </span><span class="nl">ManagedAccountTransfer</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">TransferDetails</span><span class="p">.</span><span class="n">ManagedAccountTransfer</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nl">ExternalAccountDetails</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nl">AccountNumber</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">ExternalAccountDetails</span><span class="p">.</span><span class="n">AccountNumber</span><span class="p">,</span>
<span class="w">            </span><span class="nl">AccountType</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">ExternalAccountDetails</span><span class="p">.</span><span class="n">AccountType</span><span class="p">,</span>
<span class="w">            </span><span class="nl">AccountTitle</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">ExternalAccountDetails</span><span class="p">.</span><span class="n">AccountTitle</span><span class="p">,</span>
<span class="w">            </span><span class="nl">TransferringFirmDetails</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nl">FirmName</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">ExternalAccountDetails</span><span class="p">.</span><span class="n">TransferringFirmDetails</span><span class="p">.</span><span class="n">FirmName</span><span class="p">,</span>
<span class="w">                </span><span class="nl">Phone</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">ExternalAccountDetails</span><span class="p">.</span><span class="n">TransferringFirmDetails</span><span class="p">.</span><span class="n">Phone</span><span class="p">,</span>
<span class="w">                </span><span class="nl">Address</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">AcatDetails</span><span class="p">.</span><span class="n">ExternalAccountDetails</span><span class="p">.</span><span class="n">TransferringFirmDetails</span><span class="p">.</span><span class="n">Address</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>The transformation:
- Maps the ACATS details from the input payload to the output structure
- Uses <code>default null</code> for the AcatType field to handle cases where it's not provided
- Uses <code>skipNullOn="everywhere"</code> to remove null values from the output</p>
<h3 id="p-rmdresponsedwl">p-rmdResponse.dwl</h3>
<p>This transformation creates a response for Required Minimum Distribution requests.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w"> </span><span class="n">skipNullOn</span><span class="o">=</span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">        </span><span class="nl">PaymentOption</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">PaymentOption</span><span class="p">,</span>
<span class="w">        </span><span class="nl">PaymentFrequency</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">PaymentFrequency</span><span class="p">,</span>
<span class="w">        </span><span class="nl">DistributionSchedule</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">DistributionSchedule</span><span class="p">,</span>
<span class="w">        </span><span class="nl">TaxYear</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">TaxYear</span><span class="p">,</span>
<span class="w">        </span><span class="nl">CalculateRMDAmount</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">CalculateRMDAmount</span><span class="p">,</span>
<span class="w">        </span><span class="nl">WithdrawlAmount</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">WithdrawlAmount</span><span class="p">,</span>
<span class="w">        </span><span class="nl">PaymentInstructions</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">PaymentInstructions</span><span class="p">,</span>
<span class="w">        </span><span class="nl">TaxWithholdings</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">TaxWithholdings</span>
<span class="p">}</span>
</code></pre></div>

<p>The transformation:
- Maps the RMD details from the input payload to the output structure
- Uses <code>skipNullOn="everywhere"</code> to remove null values from the output</p>
<h2 id="customer-profile-transformation">Customer Profile Transformation</h2>
<h3 id="p-updateprofileresponsedwl">p-updateProfileResponse.dwl</h3>
<p>This transformation creates a response for updating customer profiles.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">var</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">ProfileInformation</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w"> </span><span class="n">skipNullOn</span><span class="o">=</span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">    </span><span class="nl">ProfileInformation</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">Addresses</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">Addresses</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">indexOfAddress</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nl">AddressLine2</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">AddressLine2</span><span class="p">,</span>
<span class="w">            </span><span class="nl">AddressLine1</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">AddressLine1</span><span class="p">,</span>
<span class="w">            </span><span class="nl">State</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">State</span><span class="p">,</span>
<span class="w">            </span><span class="nl">PostalCode</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">PostalCode</span><span class="p">,</span>
<span class="w">            </span><span class="nl">City</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">City</span><span class="p">,</span>
<span class="w">            </span><span class="nl">AddressType</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">AddressType</span><span class="p">,</span>
<span class="w">            </span><span class="nl">Country</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">Country</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nl">Email</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">Email</span><span class="p">,</span>
<span class="w">        </span><span class="nl">FirstName</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span>
<span class="w">        </span><span class="nl">Phone</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">Phone</span><span class="p">,</span>
<span class="w">        </span><span class="nl">LastName</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">LastName</span><span class="p">,</span>
<span class="w">        </span><span class="nl">Mobile</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">Mobile</span><span class="p">,</span>
<span class="w">        </span><span class="nl">BirthDate</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">BirthDate</span><span class="p">,</span>
<span class="w">        </span><span class="nl">MaritalStatus</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">MaritalStatus</span><span class="p">,</span>
<span class="w">        </span><span class="nl">EmploymentDetails</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">EmploymentDetails</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>The transformation:
- Stores the ProfileInformation from the payload in a variable for easier access
- Maps through the addresses in the profile information
- Restructures each address with the specified fields
- Maps the remaining profile fields directly
- Uses <code>skipNullOn="everywhere"</code> to remove null values from the output</p>
<h1 id="sap-integration-suite-implementation">SAP Integration Suite Implementation</h1>
<h2 id="component-mapping">Component Mapping</h2>
<table>
<thead>
<tr>
<th>MuleSoft Component</th>
<th>SAP Integration Suite Equivalent</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>HTTP Listener</td>
<td>HTTPS Adapter</td>
<td>Configure with the same path and method settings</td>
</tr>
<tr>
<td>Router</td>
<td>Router</td>
<td>Direct equivalent in SAP Integration Suite</td>
</tr>
<tr>
<td>Flow Reference</td>
<td>Process Call</td>
<td>Used to call subflows in SAP Integration Suite</td>
</tr>
<tr>
<td>Transform Message</td>
<td>Message Mapping</td>
<td>Maps to the Content Modifier with mapping capabilities</td>
</tr>
<tr>
<td>Set Variable</td>
<td>Content Modifier</td>
<td>Used to set variables in the message header or properties</td>
</tr>
<tr>
<td>Set Payload</td>
<td>Content Modifier</td>
<td>Used to set the message body</td>
</tr>
<tr>
<td>Logger</td>
<td>Write Message to Log</td>
<td>Configure with the same log message format</td>
</tr>
<tr>
<td>Error Handler</td>
<td>Exception Subprocess</td>
<td>Handles errors in a dedicated subprocess</td>
</tr>
</tbody>
</table>
<h2 id="integration-flow-visualization">Integration Flow Visualization</h2>
<h3 id="flow-1-fsc-wealth-management-api-main">Flow 1: fsc-wealth-management-api-main</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Main API Flow
start((Start)) --> listener[HTTP Listener]:::httpAdapter
listener --> response[Response]:::contentModifier
response --> headers1[Headers]:::contentModifier
headers1 --> errorResponse[Error Response]:::contentModifier
errorResponse --> body[Body]:::contentModifier
body --> headers2[Headers]:::contentModifier
headers2 --> logger1[Logger]:::contentModifier
logger1 --> logger2[Logger]:::contentModifier
logger2 --> router{Router}:::router
router --> logger3[Logger]:::contentModifier
logger3 --> end((End))

%% Error Handler
listener -->|Error| errorHandler[(Error Handler)]:::exception
errorHandler --> end
</pre>
<h3 id="flow-2-patchinvestmentaccountsupdateapplicationjsonfsc-wealth-management-api-config">Flow 2: patch:/InvestmentAccounts/Update:application/json:fsc-wealth-management-api-config</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Update Beneficiaries Flow
start((Start)) --> updateBeneficiariesSubFlow[[update-beneficiaries-sub-flow]]:::processCall
updateBeneficiariesSubFlow --> end((End))
</pre>
<h3 id="flow-3-deleteinvestmentaccountsdeleteapplicationjsonfsc-wealth-management-api-config">Flow 3: delete:/InvestmentAccounts/Delete:application/json:fsc-wealth-management-api-config</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Delete Beneficiaries Flow
start((Start)) --> deleteBeneficiariesSubFlow[[delete-beneficiaries-sub-flow]]:::processCall
deleteBeneficiariesSubFlow --> end((End))
</pre>
<h3 id="flow-4-getinvestmentaccountsaccountidretrievefsc-wealth-management-api-config">Flow 4: get:/InvestmentAccounts/accountId/Retrieve:fsc-wealth-management-api-config</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Retrieve Investment Account Details Flow
start((Start)) --> retrieveInvestmentAccountDetailsSubFlow[[retrieve-investment-account-details-sub-flow]]:::processCall
retrieveInvestmentAccountDetailsSubFlow --> end((End))
</pre>
<h3 id="flow-5-postinvestmentaccountsinitiateapplicationjsonfsc-wealth-management-api-config">Flow 5: post:/InvestmentAccounts/Initiate:application/json:fsc-wealth-management-api-config</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Add Beneficiaries Flow
start((Start)) --> addBeneficiariesSubFlow[[add-beneficiaries-sub-flow]]:::processCall
addBeneficiariesSubFlow --> end((End))
</pre>
<h3 id="flow-6-patchcustomerscustomeridapplicationjsonfsc-wealth-management-api-config">Flow 6: patch:/customers/customerId:application/json:fsc-wealth-management-api-config</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Update Customers Profile Flow
start((Start)) --> updateCustomersProfileSubFlow[[update-customers-profile-sub-flow]]:::processCall
updateCustomersProfileSubFlow --> end((End))
</pre>
<h3 id="flow-7-patchinvestmentaccountsaccountidpaymentsupdateapplicationjsonfsc-wealth-management-api-config">Flow 7: patch:/InvestmentAccounts/accountId/Payments/Update:application/json:fsc-wealth-management-api-config</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Cancel Standing Orders Flow
start((Start)) --> cancelStandingOrdersSubFlow[[cancel-standing-orders-sub-flow]]:::processCall
cancelStandingOrdersSubFlow --> end((End))
</pre>
<h3 id="flow-8-postinvestmentaccountsaccountidpaymentsinitiateapplicationjsonfsc-wealth-management-api-config">Flow 8: post:/InvestmentAccounts/accountId/Payments/Initiate:application/json:fsc-wealth-management-api-config</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Add Standing Orders Flow
start((Start)) --> addStandingOrdersSubFlow[[add-standing-orders-sub-flow]]:::processCall
addStandingOrdersSubFlow --> end((End))
</pre>
<h3 id="flow-9-getinvestmentaccountsaccountidpaymentsretrievefsc-wealth-management-api-config">Flow 9: get:/InvestmentAccounts/accountId/Payments/Retrieve:fsc-wealth-management-api-config</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Retrieve Standing Orders Flow
start((Start)) --> retrieveStandingOrdersSubFlow[[retrieve-standing-orders-sub-flow]]:::processCall
retrieveStandingOrdersSubFlow --> end((End))
</pre>
<h3 id="flow-10-postinvestmentaccountsaccountidacatsapplicationjsonfsc-wealth-management-api-config">Flow 10: post:/InvestmentAccounts/accountId/Acats:application/json:fsc-wealth-management-api-config</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% ACATS Flow
start((Start)) --> prepareAcatsResponseSubFlow[[prepare-acats-response-sub-flow]]:::processCall
prepareAcatsResponseSubFlow --> end((End))
</pre>
<h3 id="flow-11-postinvestmentaccountsaccountidrmdapplicationjsonfsc-wealth-management-api-config">Flow 11: post:/InvestmentAccounts/accountId/RMD:application/json:fsc-wealth-management-api-config</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% RMD Flow
start((Start)) --> prepareRmdResponseSubFlow[[prepare-rmd-response-sub-flow]]:::processCall
prepareRmdResponseSubFlow --> end((End))
</pre>
<h3 id="flow-12-delete-beneficiaries-sub-flow">Flow 12: delete-beneficiaries-sub-flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Delete Beneficiaries Subflow
start((Start)) --> transform[Transform]:::mapping
transform --> message[Message]:::contentModifier
message --> setPayload[Set Payload]:::contentModifier
setPayload --> end((End))
</pre>
<h3 id="flow-13-retrieve-investment-account-details-sub-flow">Flow 13: retrieve-investment-account-details-sub-flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Retrieve Investment Account Details Subflow
start((Start)) --> setVariable[Set Variable]:::contentModifier
setVariable --> transform[Transform]:::mapping
transform --> message[Message]:::contentModifier
message --> setPayload[Set Payload]:::contentModifier
setPayload --> end((End))
</pre>
<h3 id="flow-14-retrieve-standing-orders-sub-flow">Flow 14: retrieve-standing-orders-sub-flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Retrieve Standing Orders Subflow
start((Start)) --> logger[Logger]:::contentModifier
logger --> setVariable[Set Variable]:::contentModifier
setVariable --> transform[Transform]:::mapping
transform --> message[Message]:::contentModifier
message --> setPayload[Set Payload]:::contentModifier
setPayload --> end((End))
</pre>
<h3 id="flow-15-update-customers-profile-sub-flow">Flow 15: update-customers-profile-sub-flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Update Customers Profile Subflow
start((Start)) --> transform[Transform]:::mapping
transform --> message[Message]:::contentModifier
message --> setPayload[Set Payload]:::contentModifier
setPayload --> end((End))
</pre>
<h3 id="flow-16-cancel-standing-orders-sub-flow">Flow 16: cancel-standing-orders-sub-flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Cancel Standing Orders Subflow
start((Start)) --> transform[Transform]:::mapping
transform --> message[Message]:::contentModifier
message --> setPayload[Set Payload]:::contentModifier
setPayload --> end((End))
</pre>
<h3 id="flow-17-update-beneficiaries-sub-flow">Flow 17: update-beneficiaries-sub-flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Update Beneficiaries Subflow
start((Start)) --> transform[Transform]:::mapping
transform --> message[Message]:::contentModifier
message --> setPayload[Set Payload]:::contentModifier
setPayload --> end((End))
</pre>
<h3 id="flow-18-prepare-acats-response-sub-flow">Flow 18: prepare-acats-response-sub-flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Prepare ACATS Response Subflow
start((Start)) --> transform[Transform]:::mapping
transform --> message[Message]:::contentModifier
message --> setPayload[Set Payload]:::contentModifier
setPayload --> end((End))
</pre>
<h3 id="flow-19-add-standing-orders-sub-flow">Flow 19: add-standing-orders-sub-flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Add Standing Orders Subflow
start((Start)) --> transform[Transform]:::mapping
transform --> message[Message]:::contentModifier
message --> setPayload[Set Payload]:::contentModifier
setPayload --> end((End))
</pre>
<h3 id="flow-20-prepare-rmd-response-sub-flow">Flow 20: prepare-rmd-response-sub-flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Prepare RMD Response Subflow
start((Start)) --> transform[Transform]:::mapping
transform --> message[Message]:::contentModifier
message --> setPayload[Set Payload]:::contentModifier
setPayload --> end((End))
</pre>
<h3 id="flow-21-add-beneficiaries-sub-flow">Flow 21: add-beneficiaries-sub-flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Add Beneficiaries Subflow
start((Start)) --> transform[Transform]:::mapping
transform --> message[Message]:::contentModifier
message --> setPayload[Set Payload]:::contentModifier
setPayload --> end((End))
</pre>
<h2 id="configuration-details">Configuration Details</h2>
<h3 id="https-adapter-configuration">HTTPS Adapter Configuration</h3>
<ul>
<li><strong>Address</strong>: <code>/fsc-wealth-management-api</code></li>
<li><strong>Port</strong>: 443 (HTTPS)</li>
<li><strong>Authentication</strong>: Basic or OAuth2 (configuration decision)</li>
<li><strong>TLS Configuration</strong>: Required, using keystore from <code>integration@keystore</code> secret</li>
</ul>
<h3 id="router-configuration">Router Configuration</h3>
<ul>
<li><strong>Condition Type</strong>: Content-based routing</li>
<li><strong>Routing Rules</strong>: Based on HTTP method and path patterns</li>
<li><strong>Default Route</strong>: Error response</li>
</ul>
<h3 id="content-modifier-configuration">Content Modifier Configuration</h3>
<ul>
<li><strong>Message Headers</strong>: Set appropriate response headers</li>
<li><strong>Message Body</strong>: Set response payload</li>
<li><strong>Exchange Properties</strong>: Set variables for processing</li>
</ul>
<h3 id="message-mapping-configuration">Message Mapping Configuration</h3>
<ul>
<li><strong>Source Format</strong>: JSON</li>
<li><strong>Target Format</strong>: JSON</li>
<li><strong>Mapping Scripts</strong>: Implement the DataWeave transformations using SAP Integration Suite mapping capabilities</li>
</ul>
<h3 id="process-call-configuration">Process Call Configuration</h3>
<ul>
<li><strong>Process Reference</strong>: Reference to the appropriate subflow</li>
<li><strong>Parameters</strong>: Pass necessary context variables</li>
</ul>
<h3 id="write-message-to-log-configuration">Write Message to Log Configuration</h3>
<ul>
<li><strong>Log Level</strong>: INFO</li>
<li><strong>Message</strong>: Same format as in MuleSoft logger components</li>
</ul>
<h3 id="exception-subprocess-configuration">Exception Subprocess Configuration</h3>
<ul>
<li><strong>Error Types</strong>: Map to MuleSoft error types (APIKIT:BAD_REQUEST, APIKIT:NOT_FOUND, etc.)</li>
<li><strong>Error Handling</strong>: Generate appropriate error responses with status codes</li>
</ul>
<h1 id="configuration">Configuration</h1>
<h2 id="important-configuration-parameters">Important Configuration Parameters</h2>
<ul>
<li><strong>API Definition</strong>: The API is defined in RAML 1.0 format with the main file <code>fsc-wealth-management-api.raml</code></li>
<li><strong>HTTP Listener Configuration</strong>: Named <code>fsc-wealth-management-api-httpListenerConfig</code></li>
<li><strong>API Configuration</strong>: Named <code>fsc-wealth-management-api-config</code> with outbound headers map and HTTP status variable</li>
</ul>
<h2 id="environment-variables">Environment Variables</h2>
<ul>
<li>No explicit environment variables are defined in the source documentation</li>
</ul>
<h2 id="dependencies-on-external-systems">Dependencies on External Systems</h2>
<ul>
<li>The application appears to be self-contained with mock responses</li>
<li>No explicit external system dependencies are mentioned in the source documentation</li>
</ul>
<h2 id="security-settings-and-certificates">Security Settings and Certificates</h2>
<ul>
<li><strong>TLS Configuration</strong>: The application uses TLS with keystore and key secrets defined in <code>config.yaml</code></li>
<li><strong>Keystore Secret</strong>: <code>integration@keystore</code></li>
<li><strong>Key Secret</strong>: <code>integration@keystore</code></li>
</ul>
    
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
</body>
</html>