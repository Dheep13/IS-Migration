<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation with Mermaid</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        h1, h2, h3 {
            color: #1565c0;
        }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        code {
            background: #f5f5f5;
            padding: 2px 5px;
            border-radius: 3px;
        }
        pre.mermaid {
            text-align: center;
            background: white;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .note {
            background: #e3f2fd;
            padding: 10px;
            border-left: 4px solid #1565c0;
            margin: 10px 0;
        }
        .insights {
            background: #f3e5f5;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .best-practices {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .security {
            background: #ffebee;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1 id="api-overview">API Overview</h1>
<p>The Financial Services Cloud Wealth Management API provides a comprehensive set of endpoints for managing investment accounts, beneficiaries, standing orders, and customer profiles. It enables financial institutions to handle wealth management operations including account creation, beneficiary management, payment processing, and specialized financial operations like ACATS (Automated Customer Account Transfer Service) and RMD (Required Minimum Distribution).</p>
<ul>
<li>Base URL: <code>/api/v1</code></li>
</ul>
<h1 id="endpoints">Endpoints</h1>
<h2 id="investment-accounts">Investment Accounts</h2>
<h3 id="post-investmentaccountsinitiate">POST /InvestmentAccounts/Initiate</h3>
<ul>
<li><strong>Purpose</strong>: Initialize a new investment account with beneficiaries</li>
<li><strong>Request Body</strong>: JSON containing account and beneficiary details</li>
<li><strong>Response</strong>: 201 Created with the created beneficiary details including generated BeneficiaryIds</li>
<li><strong>Example Response</strong>:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;InvestmentAccounts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;AccountIds&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;123456789&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;Beneficiaries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;Primary&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;BeneficiaryName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;BeneficiaryType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Individual&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;BeneficiaryId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;BFR-1234567&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;Contingent&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;BeneficiaryName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Jane Doe&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;BeneficiaryType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Individual&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;BeneficiaryId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;BFR-7654321&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="get-investmentaccountsaccountidretrieve">GET /InvestmentAccounts/{accountId}/Retrieve</h3>
<ul>
<li><strong>Purpose</strong>: Retrieve details of a specific investment account</li>
<li><strong>Path Parameters</strong>: accountId - The unique identifier for the investment account</li>
<li><strong>Response</strong>: 200 OK with account details and beneficiaries</li>
<li><strong>Example Response</strong>:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;LinkedAccount&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;AccountNumber&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AMZ10012&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;AccountHolderName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bob&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;AccountType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Individual&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;Beneficiaries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;Primary&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;BeneficiaryName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Gabriel Basso&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;BeneficiaryType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Institution&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;BeneficiaryId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;BFR-8066473&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="patch-investmentaccountsupdate">PATCH /InvestmentAccounts/Update</h3>
<ul>
<li><strong>Purpose</strong>: Update beneficiary information for investment accounts</li>
<li><strong>Request Body</strong>: JSON containing account IDs and updated beneficiary details</li>
<li><strong>Response</strong>: 200 OK with updated beneficiary information</li>
<li><strong>Example Response</strong>:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;InvestmentAccounts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;AccountIds&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;123456789&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;Beneficiaries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;Primary&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;BeneficiaryName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;John Doe Updated&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;BeneficiaryType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Individual&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;BeneficiaryId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;BFR-1234567&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="delete-investmentaccountsdelete">DELETE /InvestmentAccounts/Delete</h3>
<ul>
<li><strong>Purpose</strong>: Delete beneficiaries from investment accounts</li>
<li><strong>Request Body</strong>: JSON containing account IDs and beneficiary IDs to delete</li>
<li><strong>Response</strong>: 200 OK with confirmation of deleted beneficiaries</li>
<li><strong>Example Response</strong>:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;InvestmentAccounts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;AccountIds&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;123456789&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;Beneficiaries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;BeneficiaryId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;BFR-1234567&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;Status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DELETED&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="payment-operations">Payment Operations</h2>
<h3 id="post-investmentaccountsaccountidpaymentsinitiate">POST /InvestmentAccounts/{accountId}/Payments/Initiate</h3>
<ul>
<li><strong>Purpose</strong>: Create standing orders for an investment account</li>
<li><strong>Path Parameters</strong>: accountId - The unique identifier for the investment account</li>
<li><strong>Request Body</strong>: JSON containing payment details</li>
<li><strong>Response</strong>: 201 Created with payment details including generated PaymentId</li>
<li><strong>Example Response</strong>:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;Payments&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;PaymentType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;standing order&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;PaymentMode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bank Wire&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;CreationDateTime&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-10-09T16:34:19.993+05:30&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;PaymentId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PMT3564864&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="get-investmentaccountsaccountidpaymentsretrieve">GET /InvestmentAccounts/{accountId}/Payments/Retrieve</h3>
<ul>
<li><strong>Purpose</strong>: Retrieve standing orders for an investment account</li>
<li><strong>Path Parameters</strong>: accountId - The unique identifier for the investment account</li>
<li><strong>Query Parameters</strong>: paymentId, payeeName, amount - Optional filters for the results</li>
<li><strong>Response</strong>: 200 OK with payment order details</li>
<li><strong>Example Response</strong>:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;PaymentOrders&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;CreationDateTime&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-10-09T16:34:19.993+05:30&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;PaymentId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PMT3564864&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Payments&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;PaymentType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;standing order&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;PaymentMode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bank Wire&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="patch-investmentaccountsaccountidpaymentsupdate">PATCH /InvestmentAccounts/{accountId}/Payments/Update</h3>
<ul>
<li><strong>Purpose</strong>: Cancel standing orders for an investment account</li>
<li><strong>Path Parameters</strong>: accountId - The unique identifier for the investment account</li>
<li><strong>Request Body</strong>: JSON containing payment IDs to cancel</li>
<li><strong>Response</strong>: 200 OK with confirmation of canceled payments</li>
<li><strong>Example Response</strong>:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;PaymentIds&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;PMT3564864&quot;</span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;CancelDateTime&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-10-09T16:40:19.993+05:30&quot;</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="customer-profile-management">Customer Profile Management</h2>
<h3 id="patch-customerscustomerid">PATCH /customers/{customerId}</h3>
<ul>
<li><strong>Purpose</strong>: Update customer profile information</li>
<li><strong>Path Parameters</strong>: customerId - The unique identifier for the customer</li>
<li><strong>Request Body</strong>: JSON containing updated profile information</li>
<li><strong>Response</strong>: 200 OK with updated profile details</li>
<li><strong>Example Response</strong>:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;ProfileInformation&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;Addresses&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;AddressLine1&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;415 Mission St&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;City&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;San Francisco&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;State&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CA&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;FirstName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;John&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;LastName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;john.doe@example.com&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="specialized-financial-operations">Specialized Financial Operations</h2>
<h3 id="post-investmentaccountsaccountidacats">POST /InvestmentAccounts/{accountId}/Acats</h3>
<ul>
<li><strong>Purpose</strong>: Initiate an ACATS (Automated Customer Account Transfer Service) request</li>
<li><strong>Path Parameters</strong>: accountId - The unique identifier for the investment account</li>
<li><strong>Request Body</strong>: JSON containing ACATS details</li>
<li><strong>Response</strong>: 201 Created with ACATS details</li>
<li><strong>Example Response</strong>:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;AcatDetails&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;TransferType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Full&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;TransferAction&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Inwards&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ExternalAccountDetails&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;AccountNumber&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;EXT12345&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;AccountType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Individual&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="post-investmentaccountsaccountidrmd">POST /InvestmentAccounts/{accountId}/RMD</h3>
<ul>
<li><strong>Purpose</strong>: Process a Required Minimum Distribution (RMD) request</li>
<li><strong>Path Parameters</strong>: accountId - The unique identifier for the investment account</li>
<li><strong>Request Body</strong>: JSON containing RMD details</li>
<li><strong>Response</strong>: 201 Created with RMD details</li>
<li><strong>Example Response</strong>:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;PaymentOption&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Calculated Amount&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;PaymentFrequency&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Annual&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;TaxYear&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;CalculateRMDAmount&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>

<h1 id="current-mulesoft-flow-logic">Current MuleSoft Flow Logic</h1>
<h2 id="main-flow-fsc-wealth-management-api-main">Main Flow: fsc-wealth-management-api-main</h2>
<p>This is the main entry point for the API that handles HTTP requests, routes them to the appropriate subflows, and handles errors.</p>
<ol>
<li><strong>Trigger</strong>: HTTP listener configured to receive requests</li>
<li><strong>Processing Steps</strong>:</li>
<li>Logs request details including requestId and flowRefId</li>
<li>Routes the request to the appropriate flow based on the HTTP method and path</li>
<li>Logs the response payload</li>
<li><strong>Error Handling</strong>: Uses a common exception handler for API errors</li>
</ol>
<h2 id="flow-postinvestmentaccountsinitiateapplicationjsonfsc-wealth-management-api-config">Flow: post:\InvestmentAccounts\Initiate:application\json:fsc-wealth-management-api-config</h2>
<ol>
<li><strong>Trigger</strong>: POST request to /InvestmentAccounts/Initiate</li>
<li><strong>Processing Steps</strong>: </li>
<li>Routes to add-beneficiaries-sub-flow</li>
<li>Transforms the request payload to generate beneficiary IDs</li>
<li><strong>Expected Outcome</strong>: Returns a 201 Created response with beneficiary details</li>
</ol>
<h2 id="flow-getinvestmentaccountsaccountidretrievefsc-wealth-management-api-config">Flow: get:\InvestmentAccounts(accountId)\Retrieve:fsc-wealth-management-api-config</h2>
<ol>
<li><strong>Trigger</strong>: GET request to /InvestmentAccounts/{accountId}/Retrieve</li>
<li><strong>Processing Steps</strong>:</li>
<li>Routes to retrieve-investment-account-details-sub-flow</li>
<li>Sets account ID as a variable</li>
<li>Transforms the response to include linked account and beneficiary details</li>
<li><strong>Expected Outcome</strong>: Returns a 200 OK response with account details</li>
</ol>
<h2 id="flow-patchinvestmentaccountsupdateapplicationjsonfsc-wealth-management-api-config">Flow: patch:\InvestmentAccounts\Update:application\json:fsc-wealth-management-api-config</h2>
<ol>
<li><strong>Trigger</strong>: PATCH request to /InvestmentAccounts/Update</li>
<li><strong>Processing Steps</strong>:</li>
<li>Routes to update-beneficiaries-sub-flow</li>
<li>Transforms the request payload to update beneficiary information</li>
<li><strong>Expected Outcome</strong>: Returns a 200 OK response with updated beneficiary details</li>
</ol>
<h2 id="flow-deleteinvestmentaccountsdeleteapplicationjsonfsc-wealth-management-api-config">Flow: delete:\InvestmentAccounts\Delete:application\json:fsc-wealth-management-api-config</h2>
<ol>
<li><strong>Trigger</strong>: DELETE request to /InvestmentAccounts/Delete</li>
<li><strong>Processing Steps</strong>:</li>
<li>Routes to delete-beneficiaries-sub-flow</li>
<li>Transforms the request payload to mark beneficiaries as deleted</li>
<li><strong>Expected Outcome</strong>: Returns a 200 OK response with deletion confirmation</li>
</ol>
<h2 id="flow-postinvestmentaccountsaccountidpaymentsinitiateapplicationjsonfsc-wealth-management-api-config">Flow: post:\InvestmentAccounts(accountId)\Payments\Initiate:application\json:fsc-wealth-management-api-config</h2>
<ol>
<li><strong>Trigger</strong>: POST request to /InvestmentAccounts/{accountId}/Payments/Initiate</li>
<li><strong>Processing Steps</strong>:</li>
<li>Routes to add-standing-orders-sub-flow</li>
<li>Transforms the request payload to generate payment IDs</li>
<li><strong>Expected Outcome</strong>: Returns a 201 Created response with payment details</li>
</ol>
<h2 id="flow-getinvestmentaccountsaccountidpaymentsretrievefsc-wealth-management-api-config">Flow: get:\InvestmentAccounts(accountId)\Payments\Retrieve:fsc-wealth-management-api-config</h2>
<ol>
<li><strong>Trigger</strong>: GET request to /InvestmentAccounts/{accountId}/Payments/Retrieve</li>
<li><strong>Processing Steps</strong>:</li>
<li>Routes to retrieve-standing-orders-sub-flow</li>
<li>Logs query parameters</li>
<li>Sets account ID as a variable</li>
<li>Filters payment orders based on query parameters</li>
<li><strong>Expected Outcome</strong>: Returns a 200 OK response with filtered payment orders</li>
</ol>
<h2 id="flow-patchinvestmentaccountsaccountidpaymentsupdateapplicationjsonfsc-wealth-management-api-config">Flow: patch:\InvestmentAccounts(accountId)\Payments\Update:application\json:fsc-wealth-management-api-config</h2>
<ol>
<li><strong>Trigger</strong>: PATCH request to /InvestmentAccounts/{accountId}/Payments/Update</li>
<li><strong>Processing Steps</strong>:</li>
<li>Routes to cancel-standing-orders-sub-flow</li>
<li>Transforms the request payload to include cancellation timestamp</li>
<li><strong>Expected Outcome</strong>: Returns a 200 OK response with cancellation confirmation</li>
</ol>
<h2 id="flow-patchcustomerscustomeridapplicationjsonfsc-wealth-management-api-config">Flow: patch:\customers(customerId):application\json:fsc-wealth-management-api-config</h2>
<ol>
<li><strong>Trigger</strong>: PATCH request to /customers/{customerId}</li>
<li><strong>Processing Steps</strong>:</li>
<li>Routes to update-customers-profile-sub-flow</li>
<li>Transforms the request payload to update customer profile information</li>
<li><strong>Expected Outcome</strong>: Returns a 200 OK response with updated profile details</li>
</ol>
<h2 id="flow-postinvestmentaccountsaccountidacatsapplicationjsonfsc-wealth-management-api-config">Flow: post:\InvestmentAccounts(accountId)\Acats:application\json:fsc-wealth-management-api-config</h2>
<ol>
<li><strong>Trigger</strong>: POST request to /InvestmentAccounts/{accountId}/Acats</li>
<li><strong>Processing Steps</strong>:</li>
<li>Routes to prepare-acats-response-sub-flow</li>
<li>Transforms the request payload to prepare ACATS response</li>
<li><strong>Expected Outcome</strong>: Returns a 201 Created response with ACATS details</li>
</ol>
<h2 id="flow-postinvestmentaccountsaccountidrmdapplicationjsonfsc-wealth-management-api-config">Flow: post:\InvestmentAccounts(accountId)\RMD:application\json:fsc-wealth-management-api-config</h2>
<ol>
<li><strong>Trigger</strong>: POST request to /InvestmentAccounts/{accountId}/RMD</li>
<li><strong>Processing Steps</strong>:</li>
<li>Routes to prepare-rmd-response-sub-flow</li>
<li>Transforms the request payload to prepare RMD response</li>
<li><strong>Expected Outcome</strong>: Returns a 201 Created response with RMD details</li>
</ol>
<h1 id="dataweave-transformations-explained">DataWeave Transformations Explained</h1>
<h2 id="p-addbeneficiariesresponsedwl">p-addBeneficiariesResponse.dwl</h2>
<p>This transformation generates unique beneficiary IDs for new beneficiaries and structures the response.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfr</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BFR-&quot;</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrTrack</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BFRTRACK&quot;</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrNumbers</span><span class="o">=</span><span class="w"> </span><span class="err">&#39;</span><span class="mo">01234567</span><span class="mi">89</span><span class="err">&#39;</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrCharSetLength</span><span class="o">=</span><span class="w"> </span><span class="n">sizeOf</span><span class="p">(</span><span class="n">bfrNumbers</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrNumbersLength</span><span class="o">=</span><span class="w"> </span><span class="mi">7</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w"> </span><span class="n">skipNullOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">    </span><span class="nl">InvestmentAccounts</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">AccountIds</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">InvestmentAccounts</span><span class="p">.</span><span class="n">AccountIds</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">accountId</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">indexOfAccountId</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">accountId</span><span class="p">,</span>
<span class="w">        </span><span class="nl">Beneficiaries</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nl">Primary</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">InvestmentAccounts</span><span class="p">.</span><span class="n">Beneficiaries</span><span class="p">.</span><span class="n">Primary</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nl">BeneficiaryId</span><span class="p">:</span><span class="w"> </span><span class="n">bfr</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">bfrNumbersLength</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="n">bfrNumbers</span><span class="p">[</span><span class="n">randomInt</span><span class="p">(</span><span class="n">bfrCharSetLength</span><span class="p">)]</span><span class="w"> </span><span class="n">joinBy</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}),</span>
<span class="w">            </span><span class="nl">Contingent</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">InvestmentAccounts</span><span class="p">.</span><span class="n">Beneficiaries</span><span class="p">.</span><span class="n">Contingent</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nl">BeneficiaryId</span><span class="p">:</span><span class="w"> </span><span class="n">bfr</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">bfrNumbersLength</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="n">bfrNumbers</span><span class="p">[</span><span class="n">randomInt</span><span class="p">(</span><span class="n">bfrCharSetLength</span><span class="p">)]</span><span class="w"> </span><span class="n">joinBy</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li><strong>Input</strong>: JSON with account IDs and beneficiary details</li>
<li><strong>Output</strong>: JSON with the same structure plus generated BeneficiaryId fields</li>
<li><strong>Key Operations</strong>:</li>
<li>Uses <code>map</code> to iterate through arrays of primary and contingent beneficiaries</li>
<li>Generates random numeric IDs with prefix "BFR-" using <code>randomInt</code></li>
<li>Uses <code>++</code> to append the BeneficiaryId to each beneficiary object</li>
<li>Uses <code>skipNullOn = "everywhere"</code> to exclude null values from the output</li>
</ul>
<h2 id="p-retrievepaymentordersresponsedwl">p-retrievePaymentOrdersResponse.dwl</h2>
<p>This transformation filters payment orders based on query parameters.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w">  </span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">  </span><span class="nl">PaymentOrders</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="o">?</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="o">?</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">PaymentId</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PayeeReference</span><span class="p">.</span><span class="n">PayeeName</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PaymentDefinition</span><span class="p">.</span><span class="n">PaymentAmount</span><span class="p">.</span><span class="n">Amount</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="o">?</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">PaymentId</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PayeeReference</span><span class="p">.</span><span class="n">PayeeName</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="o">?</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">PaymentId</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PaymentDefinition</span><span class="p">.</span><span class="n">PaymentAmount</span><span class="p">.</span><span class="n">Amount</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="o">?</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PayeeReference</span><span class="p">.</span><span class="n">PayeeName</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PaymentDefinition</span><span class="p">.</span><span class="n">PaymentAmount</span><span class="p">.</span><span class="n">Amount</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">PaymentId</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">paymentId</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PayeeReference</span><span class="p">.</span><span class="n">PayeeName</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">payeeName</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="o">?</span><span class="p">)</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="p">.</span><span class="n">Payments</span><span class="p">.</span><span class="n">PaymentDefinition</span><span class="p">.</span><span class="n">PaymentAmount</span><span class="p">.</span><span class="n">Amount</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="n">attributes</span><span class="p">.</span><span class="n">queryParams</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">      </span><span class="n">vars</span><span class="p">.</span><span class="n">paymentOrders</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li><strong>Input</strong>: Query parameters and payment orders stored in a variable</li>
<li><strong>Output</strong>: Filtered payment orders based on query parameters</li>
<li><strong>Key Operations</strong>:</li>
<li>Uses nested <code>if/else if</code> conditions to handle different combinations of query parameters</li>
<li>Uses <code>filter</code> with the <code>~=</code> (contains) operator to match payment orders</li>
<li>Returns all payment orders if no query parameters are provided</li>
</ul>
<h2 id="p-updatebeneficiariesresponsedwl">p-updateBeneficiariesResponse.dwl</h2>
<p>This transformation updates beneficiary information and generates IDs for new beneficiaries.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfr</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BFR-&quot;</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrTrack</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BFRTRACK&quot;</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrNumbers</span><span class="o">=</span><span class="w"> </span><span class="err">&#39;</span><span class="mo">01234567</span><span class="mi">89</span><span class="err">&#39;</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrCharSetLength</span><span class="o">=</span><span class="w"> </span><span class="n">sizeOf</span><span class="p">(</span><span class="n">bfrNumbers</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="n">var</span><span class="w"> </span><span class="n">bfrNumbersLength</span><span class="o">=</span><span class="w"> </span><span class="mi">7</span>

<span class="n">fun</span><span class="w"> </span><span class="n">treeFilter</span><span class="p">(</span><span class="n">value</span><span class="o">:</span><span class="w"> </span><span class="n">Any</span><span class="p">,</span><span class="w"> </span><span class="n">predicate</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="o">:</span><span class="n">Any</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Boolean</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">value</span><span class="w">  </span><span class="n">match</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">object</span><span class="w"> </span><span class="no">is</span><span class="w"> </span><span class="no">Object</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">  </span><span class="no">do</span><span class="w"> </span><span class="err">{</span>
<span class="w">               </span><span class="no">object</span><span class="w"> </span><span class="no">mapObject</span><span class="w"> </span><span class="p">((</span><span class="no">value</span><span class="p">,</span><span class="w"> </span><span class="no">key</span><span class="p">,</span><span class="w"> </span><span class="no">index</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span>
<span class="w">                    </span><span class="p">(</span><span class="no">key</span><span class="p">):</span><span class="w"> </span><span class="n">treeFilter</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">predicate</span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">                </span><span class="n">filterObject</span><span class="w"> </span><span class="p">((</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">predicate</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">array</span><span class="w"> </span><span class="no">is</span><span class="w"> </span><span class="no">Array</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">do</span><span class="w"> </span><span class="err">{</span>
<span class="w">                    </span><span class="no">array</span><span class="w"> </span><span class="no">map</span><span class="w"> </span><span class="p">((</span><span class="no">item</span><span class="p">,</span><span class="w"> </span><span class="no">index</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">treeFilter</span><span class="p">(</span><span class="no">item</span><span class="p">,</span><span class="w"> </span><span class="no">predicate</span><span class="p">))</span>
<span class="w">                                         </span><span class="no">filter</span><span class="w"> </span><span class="p">((</span><span class="no">item</span><span class="p">,</span><span class="w"> </span><span class="no">index</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">predicate</span><span class="p">(</span><span class="no">item</span><span class="p">))</span><span class="w">                 </span>
<span class="w">            </span><span class="err">}</span>
<span class="w">            </span><span class="no">else</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">$</span>
<span class="w">    </span><span class="err">}</span>

<span class="no">output</span><span class="w"> </span><span class="no">application</span><span class="o">/</span><span class="no">json</span><span class="w"> </span><span class="no">skipNullOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="err">{</span>
<span class="w">    </span><span class="nl">InvestmentAccounts</span><span class="p">:</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="nl">AccountIds</span><span class="p">:</span><span class="w"> </span><span class="no">payload</span><span class="p">.</span><span class="no">InvestmentAccounts</span><span class="p">.</span><span class="no">AccountIds</span><span class="w"> </span><span class="no">map</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="no">accountId</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="no">indexOfAccountId</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">accountId</span><span class="p">,</span>
<span class="w">        </span><span class="nl">Addresses</span><span class="p">:</span><span class="w"> </span><span class="no">payload</span><span class="p">.</span><span class="no">InvestmentAccounts</span><span class="p">.</span><span class="no">Addresses</span><span class="p">,</span>
<span class="w">        </span><span class="nl">Beneficiaries</span><span class="p">:</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="nl">Primary</span><span class="p">:</span><span class="w"> </span><span class="no">payload</span><span class="p">.</span><span class="no">InvestmentAccounts</span><span class="p">.</span><span class="no">Beneficiaries</span><span class="p">.</span><span class="no">Primary</span><span class="w"> </span><span class="no">map</span><span class="w"> </span><span class="no">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="no">$</span><span class="p">.</span><span class="no">BeneficiaryId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">null</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="no">$</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="err">{</span>
<span class="w">                </span><span class="s">&quot;BeneficiaryId&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">bfr</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">bfrNumbersLength</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="n">bfrNumbers</span><span class="p">[</span><span class="n">randomInt</span><span class="p">(</span><span class="n">bfrCharSetLength</span><span class="p">)]</span><span class="w"> </span><span class="n">joinBy</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">})</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">$</span><span class="p">,</span>
<span class="w">            </span><span class="nl">Contingent</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">InvestmentAccounts</span><span class="p">.</span><span class="n">Beneficiaries</span><span class="p">.</span><span class="n">Contingent</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">$</span><span class="p">.</span><span class="n">BeneficiaryId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">null</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;BeneficiaryId&quot;</span><span class="o">:</span><span class="w"> </span><span class="n">bfr</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">bfrNumbersLength</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="n">bfrNumbers</span><span class="p">[</span><span class="n">randomInt</span><span class="p">(</span><span class="n">bfrCharSetLength</span><span class="p">)]</span><span class="w"> </span><span class="n">joinBy</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">})</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">$</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span><span class="w"> </span><span class="n">treeFilter</span><span class="w"> </span><span class="p">((</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span>
<span class="w">    </span><span class="n">value</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">v</span><span class="w"> </span><span class="no">is</span><span class="w"> </span><span class="no">Array</span><span class="o">|</span><span class="w"> </span><span class="no">Object</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="no">Null</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="no">isEmpty</span><span class="p">(</span><span class="no">v</span><span class="p">)</span>
<span class="w">        </span><span class="no">else</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">true</span>
<span class="w">    </span><span class="err">}</span>
<span class="p">)</span>
</code></pre></div>

<ul>
<li><strong>Input</strong>: JSON with account IDs and updated beneficiary details</li>
<li><strong>Output</strong>: JSON with updated beneficiary information and generated IDs for new beneficiaries</li>
<li><strong>Key Operations</strong>:</li>
<li>Defines a recursive <code>treeFilter</code> function to remove empty values from the output</li>
<li>Uses conditional mapping to generate IDs only for beneficiaries without existing IDs</li>
<li>Uses pattern matching to handle different data types in the filter function</li>
<li>Applies the filter to the entire output to remove empty values</li>
</ul>
<h2 id="p-addpaymentordersresponsedwl">p-addPaymentOrdersResponse.dwl</h2>
<p>This transformation generates unique payment IDs for new payment orders.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">var</span><span class="w"> </span><span class="n">sot</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PMT&quot;</span>
<span class="n">var</span><span class="w"> </span><span class="n">stordTrack</span><span class="o">=</span><span class="w"> </span><span class="s">&quot;STORDTRACK&quot;</span>
<span class="n">var</span><span class="w"> </span><span class="n">sotNumbers</span><span class="o">=</span><span class="w"> </span><span class="err">&#39;</span><span class="mo">01234567</span><span class="mi">89</span><span class="err">&#39;</span>
<span class="n">var</span><span class="w"> </span><span class="n">sotCharSetLength</span><span class="o">=</span><span class="w"> </span><span class="n">sizeOf</span><span class="p">(</span><span class="n">sotNumbers</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="n">var</span><span class="w"> </span><span class="n">sotNumbersLength</span><span class="o">=</span><span class="w"> </span><span class="mi">7</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w"> </span><span class="n">skipNullOn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">    </span><span class="nl">Payments</span><span class="p">:</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">Payments</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">CreationDateTime</span><span class="p">:</span><span class="w"> </span><span class="n">now</span><span class="p">(),</span>
<span class="w">        </span><span class="nl">PaymentId</span><span class="p">:</span><span class="w"> </span><span class="n">sot</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">sotNumbersLength</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="n">sotNumbers</span><span class="p">[</span><span class="n">randomInt</span><span class="p">(</span><span class="n">sotCharSetLength</span><span class="p">)]</span><span class="w"> </span><span class="n">joinBy</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li><strong>Input</strong>: JSON with payment details</li>
<li><strong>Output</strong>: JSON with the same structure plus generated PaymentId fields and creation timestamps</li>
<li><strong>Key Operations</strong>:</li>
<li>Uses <code>map</code> to iterate through the array of payments</li>
<li>Generates random numeric IDs with prefix "PMT" using <code>randomInt</code></li>
<li>Adds the current timestamp using <code>now()</code></li>
<li>Uses <code>++</code> to append the PaymentId and CreationDateTime to each payment object</li>
</ul>
<h2 id="p-updateprofileresponsedwl">p-updateProfileResponse.dwl</h2>
<p>This transformation structures the customer profile update response.</p>
<div class="codehilite"><pre><span></span><code><span class="nf">%dw</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">var</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">payload</span><span class="p">.</span><span class="n">ProfileInformation</span>
<span class="n">output</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w"> </span><span class="n">skipNullOn</span><span class="o">=</span><span class="s">&quot;everywhere&quot;</span>
<span class="o">---</span>
<span class="p">{</span>
<span class="w">    </span><span class="nl">ProfileInformation</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">Addresses</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">Addresses</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">indexOfAddress</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nl">AddressLine2</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">AddressLine2</span><span class="p">,</span>
<span class="w">            </span><span class="nl">AddressLine1</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">AddressLine1</span><span class="p">,</span>
<span class="w">            </span><span class="nl">State</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">State</span><span class="p">,</span>
<span class="w">            </span><span class="nl">PostalCode</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">PostalCode</span><span class="p">,</span>
<span class="w">            </span><span class="nl">City</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">City</span><span class="p">,</span>
<span class="w">            </span><span class="nl">AddressType</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">AddressType</span><span class="p">,</span>
<span class="w">            </span><span class="nl">Country</span><span class="p">:</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">Country</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nl">Email</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">Email</span><span class="p">,</span>
<span class="w">        </span><span class="nl">FirstName</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span>
<span class="w">        </span><span class="nl">Phone</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">Phone</span><span class="p">,</span>
<span class="w">        </span><span class="nl">LastName</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">LastName</span><span class="p">,</span>
<span class="w">        </span><span class="nl">Mobile</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">Mobile</span><span class="p">,</span>
<span class="w">        </span><span class="nl">BirthDate</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">BirthDate</span><span class="p">,</span>
<span class="w">        </span><span class="nl">MaritalStatus</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">MaritalStatus</span><span class="p">,</span>
<span class="w">        </span><span class="nl">EmploymentDetails</span><span class="p">:</span><span class="w"> </span><span class="n">ProfileInformation</span><span class="p">.</span><span class="n">EmploymentDetails</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li><strong>Input</strong>: JSON with updated profile information</li>
<li><strong>Output</strong>: JSON with structured profile information</li>
<li><strong>Key Operations</strong>:</li>
<li>Stores the ProfileInformation object in a variable for easier access</li>
<li>Maps through the Addresses array to maintain the structure</li>
<li>Explicitly lists all fields to ensure consistent output format</li>
<li>Uses <code>skipNullOn="everywhere"</code> to exclude null values from the output</li>
</ul>
<h1 id="sap-integration-suite-implementation">SAP Integration Suite Implementation</h1>
<h2 id="component-mapping">Component Mapping</h2>
<table>
<thead>
<tr>
<th>MuleSoft Component</th>
<th>SAP Integration Suite Equivalent</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>listener</td>
<td>HTTPS Adapter</td>
<td>Configure with the same endpoint paths and methods</td>
</tr>
<tr>
<td>router</td>
<td>Router</td>
<td>Maps to Content Modifier with routing logic</td>
</tr>
<tr>
<td>flow-ref</td>
<td>Process Call</td>
<td>References to subflows become process calls</td>
</tr>
<tr>
<td>set-variable</td>
<td>Content Modifier</td>
<td>For variable assignment operations</td>
</tr>
<tr>
<td>transform</td>
<td>Message Mapping</td>
<td>For DataWeave transformations</td>
</tr>
<tr>
<td>set-payload</td>
<td>Content Modifier</td>
<td>For setting response payload</td>
</tr>
<tr>
<td>logger</td>
<td>Write to Log</td>
<td>For logging operations</td>
</tr>
<tr>
<td>error-handler</td>
<td>Exception Subprocess</td>
<td>For error handling logic</td>
</tr>
<tr>
<td>headers</td>
<td>Content Modifier</td>
<td>For setting response headers</td>
</tr>
<tr>
<td>response</td>
<td>End Message</td>
<td>For sending HTTP responses</td>
</tr>
</tbody>
</table>
<h2 id="integration-flow-visualization">Integration Flow Visualization</h2>
<h3 id="flow-1-fsc-wealth-management-api-main">Flow 1: fsc-wealth-management-api-main</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Main Flow
Start((Start)) --> Listener[HTTP Listener]:::httpAdapter
Listener --> Logger1[Logger]:::contentModifier
Logger1 --> Logger2[Logger]:::contentModifier
Logger2 --> Router{Router}:::router
Router --> Logger3[Logger]:::contentModifier
Logger3 --> Response[Response]:::httpAdapter
Response --> Headers1[Headers]:::contentModifier
Headers1 --> End((End))

%% Error Handling
Listener --> ErrorHandler[(Error Handler)]:::exception
ErrorHandler --> ErrorResponse[Error Response]:::contentModifier
ErrorResponse --> Body[Body]:::contentModifier
Body --> Headers2[Headers]:::contentModifier
Headers2 --> ErrorEnd((Error End))
</pre>
<h3 id="flow-2-postinvestmentaccountsinitiateapplicationjsonfsc-wealth-management-api-config">Flow 2: post:\InvestmentAccounts\Initiate:application\json:fsc-wealth-management-api-config</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Flow
Start((Start)) --> AddBeneficiariesSubFlow[[add-beneficiaries-sub-flow]]:::processCall
AddBeneficiariesSubFlow --> End((End))
</pre>
<h3 id="flow-3-getinvestmentaccountsaccountidretrievefsc-wealth-management-api-config">Flow 3: get:\InvestmentAccounts(accountId)\Retrieve:fsc-wealth-management-api-config</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Flow
Start((Start)) --> RetrieveInvestmentAccountDetailsSubFlow[[retrieve-investment-account-details-sub-flow]]:::processCall
RetrieveInvestmentAccountDetailsSubFlow --> End((End))
</pre>
<h3 id="flow-4-patchinvestmentaccountsupdateapplicationjsonfsc-wealth-management-api-config">Flow 4: patch:\InvestmentAccounts\Update:application\json:fsc-wealth-management-api-config</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Flow
Start((Start)) --> UpdateBeneficiariesSubFlow[[update-beneficiaries-sub-flow]]:::processCall
UpdateBeneficiariesSubFlow --> End((End))
</pre>
<h3 id="flow-5-deleteinvestmentaccountsdeleteapplicationjsonfsc-wealth-management-api-config">Flow 5: delete:\InvestmentAccounts\Delete:application\json:fsc-wealth-management-api-config</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Flow
Start((Start)) --> DeleteBeneficiariesSubFlow[[delete-beneficiaries-sub-flow]]:::processCall
DeleteBeneficiariesSubFlow --> End((End))
</pre>
<h3 id="flow-6-postinvestmentaccountsaccountidpaymentsinitiateapplicationjsonfsc-wealth-management-api-config">Flow 6: post:\InvestmentAccounts(accountId)\Payments\Initiate:application\json:fsc-wealth-management-api-config</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Flow
Start((Start)) --> AddStandingOrdersSubFlow[[add-standing-orders-sub-flow]]:::processCall
AddStandingOrdersSubFlow --> End((End))
</pre>
<h3 id="flow-7-getinvestmentaccountsaccountidpaymentsretrievefsc-wealth-management-api-config">Flow 7: get:\InvestmentAccounts(accountId)\Payments\Retrieve:fsc-wealth-management-api-config</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Flow
Start((Start)) --> RetrieveStandingOrdersSubFlow[[retrieve-standing-orders-sub-flow]]:::processCall
RetrieveStandingOrdersSubFlow --> End((End))
</pre>
<h3 id="flow-8-patchinvestmentaccountsaccountidpaymentsupdateapplicationjsonfsc-wealth-management-api-config">Flow 8: patch:\InvestmentAccounts(accountId)\Payments\Update:application\json:fsc-wealth-management-api-config</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Flow
Start((Start)) --> CancelStandingOrdersSubFlow[[cancel-standing-orders-sub-flow]]:::processCall
CancelStandingOrdersSubFlow --> End((End))
</pre>
<h3 id="flow-9-patchcustomerscustomeridapplicationjsonfsc-wealth-management-api-config">Flow 9: patch:\customers(customerId):application\json:fsc-wealth-management-api-config</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Flow
Start((Start)) --> UpdateCustomersProfileSubFlow[[update-customers-profile-sub-flow]]:::processCall
UpdateCustomersProfileSubFlow --> End((End))
</pre>
<h3 id="flow-10-postinvestmentaccountsaccountidacatsapplicationjsonfsc-wealth-management-api-config">Flow 10: post:\InvestmentAccounts(accountId)\Acats:application\json:fsc-wealth-management-api-config</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Flow
Start((Start)) --> PrepareAcatsResponseSubFlow[[prepare-acats-response-sub-flow]]:::processCall
PrepareAcatsResponseSubFlow --> End((End))
</pre>
<h3 id="flow-11-postinvestmentaccountsaccountidrmdapplicationjsonfsc-wealth-management-api-config">Flow 11: post:\InvestmentAccounts(accountId)\RMD:application\json:fsc-wealth-management-api-config</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Flow
Start((Start)) --> PrepareRmdResponseSubFlow[[prepare-rmd-response-sub-flow]]:::processCall
PrepareRmdResponseSubFlow --> End((End))
</pre>
<h3 id="flow-12-delete-beneficiaries-sub-flow">Flow 12: delete-beneficiaries-sub-flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Subflow
Start((Start)) --> Transform[Transform]:::mapping
Transform --> Message[Message]:::contentModifier
Message --> SetPayload[Set Payload]:::contentModifier
SetPayload --> End((End))
</pre>
<h3 id="flow-13-retrieve-investment-account-details-sub-flow">Flow 13: retrieve-investment-account-details-sub-flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Subflow
Start((Start)) --> SetVariable[Set Variable]:::contentModifier
SetVariable --> Transform[Transform]:::mapping
Transform --> Message[Message]:::contentModifier
Message --> SetPayload[Set Payload]:::contentModifier
SetPayload --> End((End))
</pre>
<h3 id="flow-14-retrieve-standing-orders-sub-flow">Flow 14: retrieve-standing-orders-sub-flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Subflow
Start((Start)) --> Logger[Logger]:::contentModifier
Logger --> SetVariable[Set Variable]:::contentModifier
SetVariable --> Transform[Transform]:::mapping
Transform --> Message[Message]:::contentModifier
Message --> SetPayload[Set Payload]:::contentModifier
SetPayload --> End((End))
</pre>
<h3 id="flow-15-update-customers-profile-sub-flow">Flow 15: update-customers-profile-sub-flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Subflow
Start((Start)) --> Transform[Transform]:::mapping
Transform --> Message[Message]:::contentModifier
Message --> SetPayload[Set Payload]:::contentModifier
SetPayload --> End((End))
</pre>
<h3 id="flow-16-cancel-standing-orders-sub-flow">Flow 16: cancel-standing-orders-sub-flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Subflow
Start((Start)) --> Transform[Transform]:::mapping
Transform --> Message[Message]:::contentModifier
Message --> SetPayload[Set Payload]:::contentModifier
SetPayload --> End((End))
</pre>
<h3 id="flow-17-update-beneficiaries-sub-flow">Flow 17: update-beneficiaries-sub-flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Subflow
Start((Start)) --> Transform[Transform]:::mapping
Transform --> Message[Message]:::contentModifier
Message --> SetPayload[Set Payload]:::contentModifier
SetPayload --> End((End))
</pre>
<h3 id="flow-18-prepare-acats-response-sub-flow">Flow 18: prepare-acats-response-sub-flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Subflow
Start((Start)) --> Transform[Transform]:::mapping
Transform --> Message[Message]:::contentModifier
Message --> SetPayload[Set Payload]:::contentModifier
SetPayload --> End((End))
</pre>
<h3 id="flow-19-add-standing-orders-sub-flow">Flow 19: add-standing-orders-sub-flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Subflow
Start((Start)) --> Transform[Transform]:::mapping
Transform --> Message[Message]:::contentModifier
Message --> SetPayload[Set Payload]:::contentModifier
SetPayload --> End((End))
</pre>
<h3 id="flow-20-prepare-rmd-response-sub-flow">Flow 20: prepare-rmd-response-sub-flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Subflow
Start((Start)) --> Transform[Transform]:::mapping
Transform --> Message[Message]:::contentModifier
Message --> SetPayload[Set Payload]:::contentModifier
SetPayload --> End((End))
</pre>
<h3 id="flow-21-add-beneficiaries-sub-flow">Flow 21: add-beneficiaries-sub-flow</h3>
<pre class="mermaid">
flowchart TD
%% Define node styles
classDef httpAdapter fill:#87CEEB,stroke:#333,stroke-width:2px
classDef contentModifier fill:#98FB98,stroke:#333,stroke-width:2px
classDef router fill:#FFB6C1,stroke:#333,stroke-width:2px
classDef mapping fill:#DDA0DD,stroke:#333,stroke-width:2px
classDef exception fill:#FFA07A,stroke:#333,stroke-width:2px
classDef processCall fill:#F0E68C,stroke:#333,stroke-width:2px

%% Subflow
Start((Start)) --> Transform[Transform]:::mapping
Transform --> Message[Message]:::contentModifier
Message --> SetPayload[Set Payload]:::contentModifier
SetPayload --> End((End))
</pre>
<h2 id="configuration-details">Configuration Details</h2>
<h3 id="https-adapter-main-listener">HTTPS Adapter (Main Listener)</h3>
<ul>
<li><strong>Address</strong>: <code>/api/v1</code></li>
<li><strong>Supported Methods</strong>: GET, POST, PATCH, DELETE</li>
<li><strong>CSRF Protection</strong>: Enabled</li>
<li><strong>Authentication</strong>: Basic Authentication (configuration decision)</li>
</ul>
<h3 id="router">Router</h3>
<ul>
<li><strong>Condition Type</strong>: XPath</li>
<li><strong>Routing Rules</strong>: Based on HTTP method and path patterns</li>
<li><strong>Default Route</strong>: Error handler</li>
</ul>
<h3 id="content-modifier-set-variable">Content Modifier (Set Variable)</h3>
<ul>
<li><strong>Variable Name</strong>: investmentAccountDetails</li>
<li><strong>Variable Value</strong>: JSON from file or mock data</li>
</ul>
<h3 id="message-mapping">Message Mapping</h3>
<ul>
<li><strong>Source Format</strong>: JSON</li>
<li><strong>Target Format</strong>: JSON</li>
<li><strong>Mapping Type</strong>: Direct mapping with transformations</li>
<li><strong>Script Collection</strong>: Required for complex transformations like random ID generation</li>
</ul>
<h3 id="exception-subprocess">Exception Subprocess</h3>
<ul>
<li><strong>Error Types</strong>: APIKIT:BAD_REQUEST, APIKIT:NOT_FOUND, APIKIT:METHOD_NOT_ALLOWED, APIKIT:NOT_ACCEPTABLE, APIKIT:UNSUPPORTED_MEDIA_TYPE, APIKIT:NOT_IMPLEMENTED, ANY</li>
<li><strong>Error Handling</strong>: Set appropriate HTTP status code and error message</li>
</ul>
<h3 id="process-call">Process Call</h3>
<ul>
<li><strong>Process Reference</strong>: Name of the subflow to call</li>
<li><strong>Process Interface</strong>: Synchronous</li>
</ul>
<h1 id="configuration">Configuration</h1>
<h2 id="important-configuration-parameters">Important Configuration Parameters</h2>
<ul>
<li><strong>HTTP Listener Configuration</strong>: </li>
<li>Name: fsc-wealth-management-api-httpListenerConfig</li>
<li>
<p>Base Path: /api/v1</p>
</li>
<li>
<p><strong>API Configuration</strong>:</p>
</li>
<li>Name: fsc-wealth-management-api-config</li>
<li>API: fsc-wealth-management-api.raml</li>
<li>outboundHeadersMapName: outboundHeaders</li>
<li>httpStatusVarName: httpStatus</li>
</ul>
<h2 id="environment-variables">Environment Variables</h2>
<ul>
<li><strong>TLS Configuration</strong>:</li>
<li>keySecret: integration@keystore</li>
<li>keyStoreSecret: integration@keystore</li>
</ul>
<h2 id="dependencies-on-external-systems">Dependencies on External Systems</h2>
<ul>
<li>No explicit external system dependencies are mentioned in the source documentation.</li>
<li>The application appears to be using mock data or file-based data sources.</li>
</ul>
<h2 id="security-settings">Security Settings</h2>
<ul>
<li><strong>TLS Configuration</strong>: Required for HTTPS communication</li>
<li><strong>Authentication</strong>: Not explicitly defined in the source, but should be configured based on security requirements</li>
<li><strong>CSRF Protection</strong>: Should be enabled for POST, PATCH, and DELETE operations</li>
</ul>
    
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
</body>
</html>